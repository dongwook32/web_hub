<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… - hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .chat-layout { display:grid; grid-template-columns: 320px 1fr; gap:16px; padding: 24px 0; align-items: start; }
        .panel { background:#fff; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.05); }
        .panel-header { padding:14px 16px; border-bottom:1px solid #eee; font-weight:700; }
        .panel-body { padding:16px; }
        .room-list { list-style:none; }
        .room-list li { padding:10px 12px; border-radius:10px; cursor:pointer; }
        .room-list li:hover { background:#FFF0E5; }
        .room-list li.active { background:var(--primary-color); color:white; }
        .messages { height: 480px; overflow:auto; display:flex; flex-direction:column; gap:10px; }
        .msg { max-width: 70%; padding:10px 12px; border-radius:12px; background:#f7f7f7; }
        .msg.me { align-self:flex-end; background: var(--primary-color); color:#fff; }
        .composer { display:flex; gap:8px; margin-top:12px; }
        .composer input { flex:1; padding:12px 14px; border:1px solid #eee; border-radius:10px; }
        .matching-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media(max-width: 900px){ .chat-layout{ grid-template-columns:1fr; } }
    </style>
</head>
<body>
    <header id="main-header">
        <nav class="container">
            <div class="logo">
                <a href="index.html"><img src="logo.png" alt="Hub Logo" style="height:64px; vertical-align:middle; margin-right:8px;"></a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html#features">ì„œë¹„ìŠ¤ ì†Œê°œ</a></li>
                <li>
                <a href="chat.html">ëœë¤ ë§¤ì¹­</a>
                    <div class="dropdown-menu">
                        <a href="chat.html#random">ëœë¤ 1ëŒ€1 ì±„íŒ…</a>
                        <a href="chat.html#group">ê·¸ë£¹ ì±„íŒ…</a>
                    </div>
                </li>
                <li>
                    <a href="boards.html">ê²Œì‹œíŒ</a>
                    <div class="dropdown-menu">
                        <a href="boards.html#ai">AIìœµí•©ë¶€</a>
                        <a href="boards.html#bible">ì„±ì„œí•™ê³¼</a>
                        <a href="boards.html#nursing">ê°„í˜¸í•™ê³¼</a>
                        <a href="boards.html#child">ì˜ìœ ì•„ë³´ìœ¡í•™ê³¼</a>
                        <a href="boards.html#social">ì‚¬íšŒë³µì§€í•™ê³¼</a>
                    </div>
                </li>
                <li><a href="mypage.html">ë§ˆì´í˜ì´ì§€</a></li>
            </ul>
            <div class="auth-buttons">
                <a href="login.html" class="btn btn-secondary">ë¡œê·¸ì¸</a>
                <a href="signup.html" class="btn btn-primary">íšŒì›ê°€ì…</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <section id="anon-setup" class="panel" style="max-width:860px; margin:24px auto;">
            <div class="panel-header">ìµëª… í”„ë¡œí•„ ì„¤ì •</div>
            <div class="panel-body">
                <form id="anon-form">
                    <div class="field">
                        <label>ëª‡ í•™ë²ˆì¸ê°€ìš”?</label>
                        <select id="ap_year" style="width:100%; padding:12px 14px; border:1px solid #eee; border-radius:10px;">
                            <option value="">ì„ íƒ</option>
                            <option>25í•™ë²ˆ</option>
                            <option>24í•™ë²ˆ</option>
                            <option>23í•™ë²ˆ</option>
                            <option>22í•™ë²ˆ</option>
                            <option>21í•™ë²ˆ</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>ì„±ë³„ ì„ íƒ(ê³µê°œ ê¸°ì¤€)</label>
                        <div class="segmented">
                            <button type="button" class="btn active" data-gender="ë‚¨ì">ë‚¨ì</button>
                            <button type="button" class="btn" data-gender="ì—¬ì">ì—¬ì</button>
                        </div>
                    </div>
                    <div class="field">
                        <label>ë‹‰ë„¤ì„ (ìµœëŒ€ 20ì)</label>
                        <input type="text" id="ap_nickname" maxlength="20" placeholder="ì˜ˆ) ìµëª…ì˜ì¹œêµ¬" style="width:100%; padding:12px 14px; border:1px solid #eee; border-radius:10px;">
                        <div class="helper"><span id="ap_nickname_count">0</span> / 20</div>
                    </div>
                    <div class="field">
                        <label>ìê¸°ì†Œê°œ (ìµœëŒ€ 100ì)</label>
                        <textarea id="ap_bio" rows="4" maxlength="100" placeholder="ì˜ˆ) ì‚¬ëŒ ë§Œë‚˜ ì–˜ê¸°í•˜ëŠ” ê±° ì¢‹ì•„í•´ìš”. ì˜í™”/ì¹´í˜/ì‚°ì±… ì¢‹ì•„í•©ë‹ˆë‹¤." style="width:100%; padding:12px 14px; border:1px solid #eee; border-radius:10px;"></textarea>
                        <div class="helper"><span id="ap_count">0</span> / 100</div>
                    </div>
                    <div class="field">
                        <label>ê´€ì‹¬ì‚¬ ì„ íƒ</label>
                        <div id="ap_interests">
                            <span class="chip" data-value="ì˜í™”">ì˜í™”</span>
                            <span class="chip" data-value="ìš´ë™">ìš´ë™</span>
                            <span class="chip" data-value="ê²Œì„">ê²Œì„</span>
                            <span class="chip" data-value="ìŒì•…">ìŒì•…</span>
                            <span class="chip" data-value="ì¹´í˜">ì¹´í˜</span>
                            <span class="chip" data-value="ì—¬í–‰">ì—¬í–‰</span>
                            <span class="chip" data-value="ìŠ¤í„°ë””">ìŠ¤í„°ë””</span>
                            <span class="chip" data-value="ë…ì„œ">ë…ì„œ</span>
                            <span class="chip" data-value="ë§›ì§‘">ë§›ì§‘</span>
                        </div>
                        <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
                            <div style="flex:1"></div>
                        </div>
                    </div>
                    <div style="display:flex; gap:8px; margin-top:4px;">
                        <button type="submit" class="btn btn-primary" style="flex: 0 0 80%;">ì„ì‹œ ì €ì¥</button>
                        <button type="button" class="btn btn-secondary" id="ap_reset" style="flex: 0 0 20%;">ë¦¬ì…‹</button>
                    </div>
                    <div class="helper">* ì´ í˜ì´ì§€ëŠ” ì‹œì•ˆìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì´ë©”ì¼ ì¸ì¦ í›„ ì €ì¥ë©ë‹ˆë‹¤.</div>
                </form>
            </div>
        </section>
        <div class="chat-layout" id="chat-ui" style="display:none;">
            <aside class="panel">
                <div class="panel-header">ì±„íŒ…ë°© ëª©ë¡</div>
                <div class="panel-body">
                    <h4 style="margin:10px 0 6px;">1:1</h4>
                    <ul class="room-list" id="dmList">
                        <!-- ê´€ì‹¬ë¶„ì•¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„± -->
                    </ul>
                    <h4 style="margin:16px 0 6px;">ê·¸ë£¹</h4>
                    <ul class="room-list" id="groupList">
                        <!-- ìƒì„± ì‹œ í‘œì‹œ -->
                    </ul>
                    <h4 style="margin:16px 0 6px;">ê´€ì‹¬ ë¶„ì•¼</h4>
                    <ul class="room-list" id="interestList">
                        <!-- ì„ íƒí•œ ê´€ì‹¬ì‚¬ ëª©ë¡ -->
                    </ul>
                </div>
            </aside>
            <section class="panel">
                <div class="panel-header" id="chatHeader">ì±„íŒ…ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                <div class="panel-body">
                    <div id="chatContent">
                        <div id="profileCard" style="display:flex; align-items:center; gap:14px; padding:12px; border:1px solid #eee; border-radius:12px; margin-bottom:12px;">
                            <div style="width:56px; height:56px; border-radius:50%; background:#f0f0f0; display:flex; align-items:center; justify-content:center; font-size:28px;">ğŸ‘¤</div>
                        <div style="flex:1;">
                            <div id="cardNickname" style="font-weight:800;">ìµëª… í”„ë¡œí•„</div>
                            <div id="cardMeta" style="font-size:0.9rem; color:#666;"></div>
                            <div id="cardBio" style="margin-top:4px;"></div>
                        </div>
                        </div>

                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px;">
                            <div class="panel" style="box-shadow:none; border:1px solid #eee;">
                                <div class="panel-body">
                                    <div style="font-weight:800; margin-bottom:6px;">ëœë¤ 1:1 ëŒ€í™”</div>
                                    <div style="font-size:0.9rem; color:#777;">ìµëª…ìœ¼ë¡œ í•œ ëª…ê³¼ ì—°ê²°ë©ë‹ˆë‹¤.</div>
                                    <div style="margin-top:8px;">
                                        <button id="startRandom" class="btn btn-primary" style="width:100%;">1:1 ë§¤ì¹­ ì‹œì‘í•˜ê¸°</button>
                                        <div id="randomMatchingStatus" style="display:none; text-align:center; margin-top:12px;">
                                            <div style="display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:8px;">
                                                <div class="matching-spinner"></div>
                                                <span style="font-weight:600; color:var(--primary-color);">ë§¤ì¹­ ì¤‘...</span>
                                            </div>
                                            <div id="randomTimer" style="font-size:0.9rem; color:#666;">00:00:00</div>
                                            <button id="cancelRandom" class="btn btn-secondary" style="margin-top:8px; width:100%;">ë§¤ì¹­ ì·¨ì†Œ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel" style="box-shadow:none; border:1px solid #eee;">
                                <div class="panel-body">
                                    <div style="font-weight:800; margin-bottom:6px;">ëœë¤ ê·¸ë£¹ ëŒ€í™”</div>
                                    <div style="font-size:0.9rem; color:#777;">3-6ëª…ì´ ëœë¤ìœ¼ë¡œ ëª¨ì—¬ ëŒ€í™”í•©ë‹ˆë‹¤.</div>
                                    <div style="margin-top:8px;">
                                        <button id="startGroup" class="btn btn-primary" style="width:100%;">ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘í•˜ê¸°</button>
                                        <div id="groupMatchingStatus" style="display:none; text-align:center; margin-top:12px;">
                                            <div style="display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:8px;">
                                                <div class="matching-spinner"></div>
                                                <span style="font-weight:600; color:var(--primary-color);">ë§¤ì¹­ ì¤‘...</span>
                                            </div>
                                            <div id="groupTimer" style="font-size:0.9rem; color:#666;">00:00:00</div>
                                            <button id="cancelGroup" class="btn btn-secondary" style="margin-top:8px; width:100%;">ë§¤ì¹­ ì·¨ì†Œ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì‹¤ì œ ì±„íŒ… í™”ë©´ -->
                    <div id="chatRoom" style="display:none;">
                        <div class="messages" id="messages">
                            <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë¨ -->
                        </div>
                        <div class="composer">
                            <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                            <button id="sendButton" class="btn btn-primary">ì „ì†¡</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 KBU Hub. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function(){
        // ì¹´ë“œ í‘œì‹œ
        function renderCard(){
            const a = loadAnon();
            const meta = [];
            if(a?.year) meta.push(a.year);
            if(a?.gender) meta.push(a.gender);
            document.getElementById('cardMeta').textContent = meta.join(' Â· ');
            document.getElementById('cardBio').textContent = a?.bio || '';
            
            // ë‹‰ë„¤ì„ í‘œì‹œ (í”„ë¡œí•„ ì¹´ë“œì˜ ì œëª© ë¶€ë¶„)
            document.getElementById('cardNickname').textContent = a?.nickname || 'ìµëª… í”„ë¡œí•„';
        }
        renderCard();
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ í™•ì¸í•´ì•¼ í•¨)
        function isLoggedIn(){
            // ì‹œì—°ìš©: ë¡œê·¸ì¸ ìƒíƒœë¥¼ localStorageì—ì„œ í™•ì¸
            return localStorage.getItem('isLoggedIn') === 'true';
        }
        
        // ìµëª…ì¹´ë“œ ë¡œë“œ/í‘œì‹œ
        function loadAnon(){
            // ë¡œê·¸ì¸ì´ ì•ˆë˜ì–´ ìˆìœ¼ë©´ ìµëª…ì¹´ë“œ ë¡œë“œ ì•ˆí•¨
            if (!isLoggedIn()) return null;
            try { return JSON.parse(localStorage.getItem('anonProfile')||'null'); } catch(e){ return null; }
        }
        function hasAnon(){ 
            // ë¡œê·¸ì¸ì´ ì•ˆë˜ì–´ ìˆìœ¼ë©´ ìµëª…ì¹´ë“œê°€ ì—†ë‹¤ê³  íŒë‹¨
            if (!isLoggedIn()) return false;
            const a = loadAnon(); 
            return a && a.year; 
        }
        function toggleUI(){
            const chat = document.getElementById('chat-ui');
            const setup = document.getElementById('anon-setup');
            if(hasAnon()){ 
                chat.style.display='grid'; 
                setup.style.display='none'; 
            } else { 
                chat.style.display='none'; 
                setup.style.display='block'; 
            }
        }
        toggleUI();

        // form handlers
        const form = document.getElementById('anon-form');
        const bio = document.getElementById('ap_bio');
        const count = document.getElementById('ap_count');
        const nickname = document.getElementById('ap_nickname');
        const nicknameCount = document.getElementById('ap_nickname_count');
        
        bio.addEventListener('input', ()=>{ count.textContent = bio.value.length; });
        nickname.addEventListener('input', ()=>{ nicknameCount.textContent = nickname.value.length; });
        const genderBtns = Array.from(document.querySelectorAll('[data-gender]'));
        genderBtns.forEach(btn=>btn.addEventListener('click', ()=>{
            genderBtns.forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
        }));
        const chips = document.getElementById('ap_interests');
        chips.addEventListener('click', (e)=>{
            if(e.target.classList.contains('chip')){ e.target.classList.toggle('selected'); }
        });
        // ì‚¬ìš©ì ì§ì ‘ ì…ë ¥ ì œê±°ë¨
        document.getElementById('ap_reset').addEventListener('click', ()=>{
            Array.from(chips.querySelectorAll('.chip')).forEach(c=>c.classList.remove('selected'));
            bio.value=''; count.textContent='0';
            nickname.value=''; nicknameCount.textContent='0';
            document.getElementById('ap_year').value='';
            genderBtns.forEach(b=>b.classList.remove('active'));
            genderBtns[0].classList.add('active');
        });
        form.addEventListener('submit', (e)=>{
            e.preventDefault();
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            if (!isLoggedIn()) {
                alert('ìµëª… í”„ë¡œí•„ì„ ì €ì¥í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const year = document.getElementById('ap_year').value;
            const gender = (genderBtns.find(b=>b.classList.contains('active'))||{}).dataset?.gender || 'ë‚¨ì';
            const nicknameValue = nickname.value.trim() || 'ìµëª…ì˜ì¹œêµ¬';
            const interests = Array.from(chips.querySelectorAll('.chip.selected')).map(c=>c.dataset.value);
            const profile = { year, gender, nickname: nicknameValue, bio: bio.value.trim(), interests };
            localStorage.setItem('anonProfile', JSON.stringify(profile));
            toggleUI();
            renderCard();
            alert('ìµëª… í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë§¤ì¹­ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
        });

        // ê´€ì‹¬ ë¶„ì•¼ ëª©ë¡ í‘œì‹œ ë° ì±„íŒ…ë°© ìƒì„±
        function renderInterestList(){
            const interestList = document.getElementById('interestList');
            if(!interestList) return;
            interestList.innerHTML = '';
            const a = loadAnon();
            (a?.interests || []).forEach(topic => {
                const li = document.createElement('li');
                li.textContent = topic;
                li.addEventListener('click', ()=>{
                    // í´ë¦­í•œ ê´€ì‹¬ì‚¬ í•­ëª©ì„ ì±„íŒ…ë°©ìœ¼ë¡œ ë³€í™˜
                    enterInterestChatRoom(li, topic);
                });
                interestList.appendChild(li);
            });
            if(interestList.children.length === 0){
                const li2 = document.createElement('li');
                li2.style.color = '#777';
                li2.textContent = 'ì„ íƒí•œ ê´€ì‹¬ë¶„ì•¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                interestList.appendChild(li2);
            }
        }

        // ê´€ì‹¬ì‚¬ ì±„íŒ…ë°© ì…ì¥ (ê¸°ì¡´ í•­ëª©ì„ ì±„íŒ…ë°©ìœ¼ë¡œ ë³€í™˜)
        function enterInterestChatRoom(liElement, topic) {
            const roomName = `ê´€ì‹¬ì‚¬ Â· ${topic}`;
            
            // í…ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³  ì±„íŒ…ë°© ì…ì¥ë§Œ
            enterRoom(roomName);
        }
        renderInterestList();

        // ë§¤ì¹­ ìƒíƒœ ê´€ë¦¬
        let randomMatching = false;
        let groupMatching = false;
        let randomStartTime = null;
        let groupStartTime = null;
        let randomTimer = null;
        let groupTimer = null;

        const btnStartRandom = document.getElementById('startRandom');
        const btnStartGroup = document.getElementById('startGroup');
        const randomMatchingStatus = document.getElementById('randomMatchingStatus');
        const groupMatchingStatus = document.getElementById('groupMatchingStatus');
        const randomTimerEl = document.getElementById('randomTimer');
        const groupTimerEl = document.getElementById('groupTimer');
        const cancelRandom = document.getElementById('cancelRandom');
        const cancelGroup = document.getElementById('cancelGroup');
        const dmList = document.getElementById('dmList');
        const groupList = document.getElementById('groupList');

        // íƒ€ì´ë¨¸ í¬ë§·íŒ… í•¨ìˆ˜
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // 1:1 ë§¤ì¹­ ì‹œì‘
        function startRandomMatching() {
            // ìµëª…ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì„¤ì • í™”ë©´ í‘œì‹œ
            if (!hasAnon()) {
                const chat = document.getElementById('chat-ui');
                const setup = document.getElementById('anon-setup');
                chat.style.display = 'none';
                setup.style.display = 'block';
                alert('ë§¤ì¹­ì„ ì‹œì‘í•˜ë ¤ë©´ ë¨¼ì € ìµëª… í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            randomMatching = true;
            randomStartTime = Date.now();
            btnStartRandom.style.display = 'none';
            randomMatchingStatus.style.display = 'block';
            
            randomTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - randomStartTime) / 1000);
                randomTimerEl.textContent = formatTime(elapsed);
            }, 1000);

            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ì—ì„œ ë§¤ì¹­ ì™„ë£Œ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ë¬´í•œì • ëŒ€ê¸°
            // ë§¤ì¹­ì´ ì¡í ë•Œê¹Œì§€ ê³„ì† ì‹œê°„ì´ í˜ëŸ¬ê°
            // ì„œë²„ì—ì„œ ë§¤ì¹­ ì™„ë£Œ ì‹œ completeRandomMatching() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•¨
        }

        // ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘
        function startGroupMatching() {
            // ìµëª…ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì„¤ì • í™”ë©´ í‘œì‹œ
            if (!hasAnon()) {
                const chat = document.getElementById('chat-ui');
                const setup = document.getElementById('anon-setup');
                chat.style.display = 'none';
                setup.style.display = 'block';
                alert('ë§¤ì¹­ì„ ì‹œì‘í•˜ë ¤ë©´ ë¨¼ì € ìµëª… í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            groupMatching = true;
            groupStartTime = Date.now();
            btnStartGroup.style.display = 'none';
            groupMatchingStatus.style.display = 'block';
            
            groupTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - groupStartTime) / 1000);
                groupTimerEl.textContent = formatTime(elapsed);
            }, 1000);

            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ì—ì„œ ë§¤ì¹­ ì™„ë£Œ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ë¬´í•œì • ëŒ€ê¸°
            // ë§¤ì¹­ì´ ì¡í ë•Œê¹Œì§€ ê³„ì† ì‹œê°„ì´ í˜ëŸ¬ê°
            // ì„œë²„ì—ì„œ ë§¤ì¹­ ì™„ë£Œ ì‹œ completeGroupMatching() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•¨
        }

        // 1:1 ë§¤ì¹­ ì™„ë£Œ
        function completeRandomMatching() {
            randomMatching = false;
            clearInterval(randomTimer);
            btnStartRandom.style.display = 'block';
            randomMatchingStatus.style.display = 'none';
            
            // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
            const nicknames = ['ìµëª…ì˜ì¹œêµ¬', 'ìµëª…ì˜í•™ìƒ', 'ìµëª…ì˜ë™ë£Œ', 'ìµëª…ì˜ì¹œêµ¬1', 'ìµëª…ì˜í•™ìƒ1', 'ìµëª…ì˜ë™ë£Œ1'];
            const randomNickname = nicknames[Math.floor(Math.random() * nicknames.length)];
            
            createRoom(dmList, `ëœë¤ 1:1 Â· ${randomNickname}`);
            
            alert('ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì±„íŒ…ë°©ì´ ìƒì„±ë˜ì—ˆì–´ìš”.');
        }

        // ê·¸ë£¹ ë§¤ì¹­ ì™„ë£Œ
        function completeGroupMatching() {
            groupMatching = false;
            clearInterval(groupTimer);
            btnStartGroup.style.display = 'block';
            groupMatchingStatus.style.display = 'none';
            
            // ê·¸ë£¹ ë²ˆí˜¸ ìƒì„± (1ë¶€í„° ì‹œì‘)
            const groupNumber = document.querySelectorAll('#groupList li').length + 1;
            createRoom(groupList, `ëœë¤ ê·¸ë£¹ Â· ê·¸ë£¹ ${groupNumber}`);
            
            alert('ê·¸ë£¹ ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì±„íŒ…ë°©ì´ ìƒì„±ë˜ì—ˆì–´ìš”.');
        }

        // ë§¤ì¹­ ì·¨ì†Œ
        function cancelRandomMatching() {
            randomMatching = false;
            clearInterval(randomTimer);
            btnStartRandom.style.display = 'block';
            randomMatchingStatus.style.display = 'none';
        }

        function cancelGroupMatching() {
            groupMatching = false;
            clearInterval(groupTimer);
            btnStartGroup.style.display = 'block';
            groupMatchingStatus.style.display = 'none';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        btnStartRandom.addEventListener('click', startRandomMatching);
        btnStartGroup.addEventListener('click', startGroupMatching);
        cancelRandom.addEventListener('click', cancelRandomMatching);
        cancelGroup.addEventListener('click', cancelGroupMatching);

        // í˜„ì¬ í™œì„± ì±„íŒ…ë°©
        let currentRoom = null;

        // ì±„íŒ…ë°© ì…ì¥
        function enterRoom(roomName) {
            currentRoom = roomName;
            const chatHeader = document.getElementById('chatHeader');
            const chatContent = document.getElementById('chatContent');
            const chatRoom = document.getElementById('chatRoom');
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            chatHeader.textContent = roomName;
            
            // í™”ë©´ ì „í™˜
            chatContent.style.display = 'none';
            chatRoom.style.display = 'block';
            
            // ì±„íŒ…ë°© ëª©ë¡ì—ì„œ í™œì„± ìƒíƒœ í‘œì‹œ
            updateRoomSelection(roomName);
        }

        // ì±„íŒ…ë°© ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateRoomSelection(activeRoom) {
            // ëª¨ë“  ì±„íŒ…ë°©ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.room-list li').forEach(li => {
                li.classList.remove('active');
            });
            
            // í™œì„± ì±„íŒ…ë°©ì— active í´ë˜ìŠ¤ ì¶”ê°€
            document.querySelectorAll('.room-list li').forEach(li => {
                if (li.textContent === activeRoom) {
                    li.classList.add('active');
                }
            });
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message && currentRoom) {
                addMessage(message, true); // ë‚´ ë©”ì‹œì§€
                messageInput.value = '';
                
                // ì‹œì—°ìš©: 1-3ì´ˆ í›„ ìë™ ì‘ë‹µ
                setTimeout(() => {
                    const responses = [
                        'ì•ˆë…•í•˜ì„¸ìš”!',
                        'ë„¤, ë§ìŠµë‹ˆë‹¤.',
                        'ì •ë§ìš”?',
                        'í¥ë¯¸ë¡­ë„¤ìš”!',
                        'ê·¸ë ‡êµ°ìš”.',
                        'ì¢‹ì€ ìƒê°ì´ì—ìš”!'
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, false); // ìƒëŒ€ë°© ë©”ì‹œì§€
                }, Math.random() * 2000 + 1000);
            }
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(text, isMe) {
            const messages = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `msg ${isMe ? 'me' : ''}`;
            
            messageDiv.innerHTML = `<div>${text}</div>`;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // ë§¤ì¹­ ì‹œì‘ ì‹œ ê°€ì§œ ë°©ì„ ìƒì„±í•´ ëª©ë¡ì— ì¶”ê°€ (ì‹œì•ˆ)
        function createRoom(listEl, label){
            if(!listEl) return null;
            const li = document.createElement('li');
            li.textContent = label;
            li.addEventListener('click', ()=>{ enterRoom(label); });
            listEl.appendChild(li);
            return li; // ìƒì„±ëœ ìš”ì†Œ ë°˜í™˜
        }
        
        // ë©”ì‹œì§€ ì „ì†¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // í”„ë¡œí•„ ì €ì¥ ì‹œ ê´€ì‹¬ì‚¬ ëª©ë¡ ê°±ì‹ 
        window.addEventListener('storage', function(e) {
            if (e.key === 'isLoggedIn' && e.newValue === null) {
                // ë¡œê·¸ì•„ì›ƒ ì‹œ ìµëª…ì¹´ë“œ ì´ˆê¸°í™”
                const chat = document.getElementById('chat-ui');
                const setup = document.getElementById('anon-setup');
                chat.style.display = 'none';
                setup.style.display = 'block';
                // í¼ ì´ˆê¸°í™”
                document.getElementById('anon-form').reset();
                document.getElementById('ap_count').textContent = '0';
                document.getElementById('ap_nickname_count').textContent = '0';
                Array.from(document.querySelectorAll('.chip')).forEach(c => c.classList.remove('selected'));
                Array.from(document.querySelectorAll('[data-gender]')).forEach(b => b.classList.remove('active'));
                document.querySelector('[data-gender="ë‚¨ì"]').classList.add('active');
            }
            renderInterestList();
        });
        renderInterestList();
    });
    </script>
    <script src="script.js"></script>
</body>
</html>


