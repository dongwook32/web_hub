<main class="flex-grow flex items-center justify-center p-4">
    <form id="login-form" class="w-full max-w-sm bg-white p-8 rounded-xl2 shadow-card">
        <h1 class="text-3xl font-bold text-center mb-2">KBU hub</h1>
        <p class="text-center text-cocoa mb-8">로그인하고 커뮤니티에 참여하세요!</p>
        
        <div id="error-message" class="text-red-500 text-center text-sm mb-4 h-5"></div>

        <div class="mb-4">
            <label for="studentId" class="block text-sm font-semibold mb-2">학번</label>
            <input type="text" id="studentId" name="studentId" required class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-peachDeep/50 transition">
        </div>
        
        <div class="mb-6">
            <label for="password" class="block text-sm font-semibold mb-2">비밀번호</label>
            <input type="password" id="password" name="password" required class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-peachDeep/50 transition">
        </div>
        
        <button type="submit" class="w-full bg-peachDeep text-white font-bold py-3 rounded-lg hover:bg-opacity-90 transition transform hover:-translate-y-0.5">
            로그인
        </button>
        
        <div class="mt-6 text-center">
            <a href="/signup" onclick="event.preventDefault(); window.spaRouter.navigateTo('/signup')" class="text-sm text-peachDeep hover:underline" style="color:var(--primary-color); font-weight:600;">아직 계정이 없나요? 회원가입</a>
        </div>
    </form>
</main>
    
<script>
    // SPA 환경에 맞게 즉시 실행 함수(IIFE)로 감싸서 스크립트가 로드될 때 바로 실행되도록 합니다.
    (function() {
        const loginForm = document.getElementById('login-form');
        const errorMessageDiv = document.getElementById('error-message');
        
        if (loginForm) {
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const studentId = document.getElementById('studentId').value;
                const password = document.getElementById('password').value;
                errorMessageDiv.textContent = '';

                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            studentId: studentId,
                            password: password
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        alert(data.message);
                        // ✅ 수정됨: 로그인 성공 후, 페이지 전체를 새로고침하여
                        // 헤더의 로그인 상태 등 모든 것을 한번에 확실하게 업데이트합니다.
                        window.location.href = '/boards';
                    } else {
                        errorMessageDiv.textContent = data.error || '로그인에 실패했습니다.';
                    }

                } catch (error) {
                    console.error('Login Error:', error);
                    errorMessageDiv.textContent = '서버와 통신할 수 없습니다.';
                }
            });
        }
    })();
</script>