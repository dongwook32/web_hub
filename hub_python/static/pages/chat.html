<body class="bg-cream">
  <div class="top-grad h-[160px] w-full absolute inset-0 -z-10 pointer-events-none"></div>

  <header class="fixed top-0 left-0 right-0 z-50 border-b border-peach/40 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="index.html" class="flex items-center gap-2 font-extrabold text-lg">
        <img src="logo.png" alt="KBU hub" class="w-9 h-9 rounded-full shadow-[0_8px_18px_rgba(255,159,128,.25)]">
        <span>hub</span>
      </a>
      <nav class="ml-auto hidden md:flex">
        <div id="navPill" class="nav-pill">
          <!-- 네비게이션 아이템은 navigation.js에서 동적으로 생성됩니다 -->
        </div>
      </nav>
      <button id="menuBtn" class="md:hidden ml-auto p-2 rounded-full border border-peach/60">☰</button>
    </div>
    <div id="mobileNav" class="hidden md:hidden px-4 pb-3 border-t border-peach/40 bg-white/70">
      <div class="flex flex-col gap-1 py-2 text-sm">
        <!-- 모바일 네비게이션 아이템은 navigation.js에서 동적으로 생성됩니다 -->
      </div>
    </div>
  </header>

  <main class="chat-layout" style="margin-top: 80px;">
    <!-- 왼쪽 사이드바 -->
    <div class="sidebar-column">
      <!-- 채팅방 목록 카드 -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <h2 class="sidebar-card-title">채팅방 목록</h2>
        </div>
        <div class="sidebar-card-body">
          <div class="sidebar-section">
            <div class="sidebar-title">1:1</div>
            <ul class="room-list" id="dmList">
              <!-- 1:1 채팅방 목록이 여기에 표시됩니다 -->
            </ul>
        </div>
        
          <div class="sidebar-section">
            <div class="sidebar-title">그룹</div>
            <ul class="room-list" id="groupList">
              <!-- 그룹 채팅방 목록이 여기에 표시됩니다 -->
            </ul>
                            </div>
                            
          <div class="sidebar-section">
            <div class="sidebar-title">관심 분야</div>
            <ul class="room-list" id="interestList">
              <!-- 관심사 기반 채팅방이 여기에 표시됩니다 -->
            </ul>
                                </div>
                            </div>
                        </div>

      <!-- 마이프로필 카드 -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <h2 class="sidebar-card-title">마이프로필</h2>
                                </div>
        <div class="sidebar-card-body">
          <div class="my-profile-content">
            <div class="my-profile-avatar" id="myProfileAvatar">👤</div>
            <div class="my-profile-info">
              <div class="my-profile-name" id="myProfileName">익명 프로필</div>
              <div class="my-profile-details" id="myProfileDetails">23학번 · 남자</div>
              <div class="my-profile-bio" id="myProfileBio">새로운 친구를 만나고 싶어요!</div>
                            </div>
            <div class="my-profile-actions">
              <button class="my-profile-edit-btn" onclick="window.spaRouter.navigateTo('/profile-setup')">수정</button>
                        </div>
          </div>
                                </div>
                            </div>
                        </div>

    <!-- 오른쪽 메인 영역 -->
    <section class="panel main-panel">
      <div class="panel-header">
        <div class="header-content">
          <div class="header-left">
            <span id="chatHeader">랜덤 매칭</span>
            <span id="participantCount" class="participant-count-header" style="display:none;"></span>
                                </div>
          <div class="header-right">
            <button id="chatOptions" class="btn-options" style="display:none;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="19" cy="12" r="1"/>
                <circle cx="5" cy="12" r="1"/>
              </svg>
                                </button>
            <button id="backToHome" class="btn-home" style="display:none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              홈으로
                                </button>
                                </div>
                            </div>
                        </div>

      <!-- 채팅 옵션 드롭다운 -->
      <div id="chatOptionsDropdown" class="chat-options-dropdown" style="display:none;">
        <div class="dropdown-header">채팅 옵션</div>
        <div class="dropdown-item" onclick="showParticipants()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          참여자 보기
                        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item danger" onclick="leaveChatRoom()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16,17 21,12 16,7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          채팅방 나가기
                            </div>
                </div>
                
      <!-- 참여자 보기 모달 -->
      <div id="participantsModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>참여자 목록</h3>
            <button class="modal-close" onclick="closeParticipantsModal()">&times;</button>
                                </div>
          <div class="modal-body">
            <div id="participantsList" class="participants-list">
              <!-- 참여자 목록이 여기에 표시됩니다 -->
                            </div>
                        </div>
                            </div>
            </div>
        
      <!-- 참여자 프로필 모달 -->
      <div id="participantProfileModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>참여자 프로필</h3>
            <button class="modal-close" onclick="closeParticipantProfileModal()">&times;</button>
                </div>
          <div class="modal-body">
            <div id="participantProfileContent" class="participant-profile">
              <!-- 참여자 프로필이 여기에 표시됩니다 -->
                </div>
          </div>
                        </div>
                        </div>

      <!-- 프로필 상세 보기 모달 -->
      <div id="profileDetailModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>프로필 상세</h3>
            <button class="modal-close" onclick="closeProfileDetailModal()">&times;</button>
                                            </div>
          <div class="modal-body">
            <div id="profileDetailContent" class="profile-detail-content">
              <!-- 프로필 상세 정보가 여기에 표시됩니다 -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                                <div class="panel-body">
        <!-- 기본 화면: 프로필 + 매칭 옵션 -->
                    <div id="chatContent">

          <!-- 랜덤 매칭 프로필 섹션 -->
          <div class="random-matching-section">
            <div class="section-header">
              <span class="section-title">✨ 랜덤 매칭 프로필</span>
                                            </div>
            <div class="profile-carousel">
              <button class="carousel-btn prev-btn" onclick="scrollProfiles(-1)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15,18 9,12 15,6"/>
                </svg>
              </button>
              <div class="profile-cards-container" id="profileCardsContainer">
                <!-- 프로필 카드들이 여기에 동적으로 생성됩니다 -->
                                        </div>
              <button class="carousel-btn next-btn" onclick="scrollProfiles(1)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9,18 15,12 9,6"/>
                </svg>
              </button>
                                    </div>
                                </div>

          <!-- 매칭 옵션 -->
          <div class="matching-grid">
            <div class="matching-card">
              <div class="matching-icon">💬</div>
              <div class="matching-title">랜덤 1:1 대화</div>
              <div class="matching-desc">익명으로 한 명과 연결됩니다.</div>
              <button id="startRandom" class="btn btn-primary">1:1 매칭 시작</button>
              <div id="randomMatchingStatus" class="matching-status">
                                                <div class="matching-spinner"></div>
                <div class="matching-text">매칭 중...</div>
                <div class="matching-timer" id="randomTimer">00:00:00</div>
                <button id="cancelRandom" class="btn btn-secondary">매칭 취소</button>
                                    </div>
                                        </div>
            
            <div class="matching-card">
              <div class="matching-icon">👥</div>
              <div class="matching-title">랜덤 그룹 대화</div>
              <div class="matching-desc">3-6명이 랜덤으로 모여 대화합니다.</div>
              <button id="startGroup" class="btn btn-primary">그룹 매칭 시작</button>
              <div id="groupMatchingStatus" class="matching-status">
                                                <div class="matching-spinner"></div>
                <div class="matching-text">매칭 중...</div>
                <div class="matching-timer" id="groupTimer">00:00:00</div>
                <button id="cancelGroup" class="btn btn-secondary">매칭 취소</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
        <!-- 채팅 화면 -->
                    <div id="chatRoom" style="display:none;">
                        <div class="messages" id="messages">
            <!-- 채팅 메시지들이 여기에 표시됩니다 -->
                        </div>
                        <div class="composer">
                            <input type="text" id="messageInput" placeholder="메시지를 입력하세요...">
                            <button id="sendButton" class="btn btn-primary">전송</button>
                        </div>
                    </div>
                </div>
            </section>
    </main>