<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KBU hub | ì±„íŒ…</title>
  <link rel="icon" href="logo.png">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
   <link rel="stylesheet" href="nav.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { peach: '#FFC8B2', peachDeep: '#FF9F80', cream: '#FFF7F2', cocoa:'#6B7280', ink:'#1F2937', mint:'#B7F4E6', lemon:'#FFF3A3' },
          boxShadow: { soft:'0 10px 30px rgba(255,159,128,.18)', glow:'0 0 0 0 rgba(255,159,128,.0)', card:'0 10px 24px rgba(17,24,39,.08)' },
          borderRadius: { bubble:'999px', xl2:'1.25rem' }
        }
      }
    }
  </script>
  <style>
    html, body { font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; }
    .top-grad{ background: radial-gradient(60% 60% at 0% 0%, #FFF0E7 0%, rgba(255,240,231,0) 60%), radial-gradient(60% 60% at 100% 0%, #FFE7DB 0%, rgba(255,231,219,0) 60%); }
    .glass{ background: rgba(255,255,255,.7); backdrop-filter: blur(10px); }
     /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ì€ nav.css (CSS Cascade Layers)ì—ì„œ ê´€ë¦¬ */
    
    /* í—¤ë” ìŠ¤íƒ€ì¼ì€ nav.cssì—ì„œ ê´€ë¦¬ */
    
    /* ë°˜ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ì€ nav.cssì—ì„œ ê´€ë¦¬ */
    
    /* ì±„íŒ… ë ˆì´ì•„ì›ƒ */
    .chat-layout { 
        display: grid; 
        grid-template-columns: 280px 1fr; 
        gap: 24px; 
        padding: 24px; 
        max-width: 1200px; 
        margin: 0 auto;
        min-height: calc(100vh - 160px);
        align-items: start;
    }
    
    /* ì‚¬ì´ë“œë°” ì»¬ëŸ¼ */
    .sidebar-column {
        display: flex;
        flex-direction: column;
        gap: 16px;
        height: fit-content;
        overflow-y: visible;
        position: sticky;
        top: 100px;
        align-self: flex-start;
    }
    
    /* ì‚¬ì´ë“œë°” ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .sidebar-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
        overflow: hidden;
        transition: all 0.3s ease;
        height: fit-content;
    }
    
    .sidebar-card:hover {
        box-shadow: 0 20px 40px rgba(17, 24, 39, 0.12);
        transform: translateY(-2px);
    }
    
    .sidebar-card-header {
        padding: 20px 20px 12px;
        border-bottom: 1px solid rgba(255, 159, 124, 0.1);
    }
    
    .sidebar-card-title {
        font-size: 16px;
        font-weight: 600;
        color: #1F2937;
        margin: 0;
    }
    
    .sidebar-card-body {
        padding: 16px 20px 20px;
    }
    
    /* ë°˜ì‘í˜• ì±„íŒ… ë ˆì´ì•„ì›ƒ */
    @media (max-width: 1024px) {
        .chat-layout {
            grid-template-columns: 280px 1fr;
            gap: 16px;
            padding: 20px;
        }
    }
    
    @media (max-width: 768px) {
        .chat-layout {
            grid-template-columns: 1fr;
            gap: 16px;
            padding: 16px;
            margin-top: 70px;
        }
        
        .sidebar-panel {
            position: relative;
            top: 0;
            max-height: 300px;
            margin-bottom: 20px;
        }
    }
    
    @media (max-width: 640px) {
        .chat-layout {
            padding: 12px;
            margin-top: 65px;
        }
    }
    
    .panel { 
        background: #fff; 
        border-radius: 16px; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
        border: 1px solid rgba(255, 200, 178, 0.2);
        overflow: hidden;
    }
    
    .sidebar-panel {
        height: fit-content;
        max-height: calc(100vh - 330px);
        position: sticky;
        top: 100px;
        overflow-y: auto;
        z-index: 10;
    }
    
    .main-panel {
        height: fit-content;
        min-height: 500px;
    }
    
    .panel-header { 
        padding: 16px 20px; 
        border-bottom: 1px solid #f0f0f0; 
        font-weight: 700; 
        background: linear-gradient(135deg, #FFF7F2, #ffffff);
        font-size: 16px;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        position: relative;
    }
    
    .header-left {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    
    .header-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .participant-count-header {
        font-size: 12px;
        color: #6B7280;
        font-weight: 400;
    }
    
    .panel-body { 
        padding: 16px 20px; 
    }
    
    .sidebar-body {
        padding: 16px 20px;
        max-height: calc(100vh - 350px);
        overflow-y: auto;
    }
    
    /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
    .sidebar-section {
        margin-bottom: 24px;
    }
    
    .sidebar-section:last-child {
        margin-bottom: 0;
    }
    
    .sidebar-title {
        font-size: 14px;
        font-weight: 600;
        color: #6B7280;
        margin-bottom: 8px;
        padding: 0 4px;
    }
    
    .room-list { 
        list-style: none; 
        margin: 0; 
        padding: 0; 
    }
    
    .room-list li { 
        padding: 12px 16px; 
        border-radius: 12px; 
        cursor: pointer; 
        margin-bottom: 4px;
        transition: all 0.3s ease;
        font-size: 14px;
        color: #374151;
    }
    
    .room-list li:hover { 
        background: #FFF0E5; 
        transform: translateX(4px);
    }
    
    .room-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
    }
    
    .room-name {
        font-weight: 600;
        color: #333;
    }
    
    .participant-count {
        font-size: 12px;
        color: #FF8C42;
        background: #FFE4D1;
        padding: 4px 10px;
        border-radius: 16px;
        font-weight: 600;
        margin-left: auto;
    }
    
    .room-name-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .unread-badge {
        background: #dc2626;
        color: white;
        font-size: 11px;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 18px;
        text-align: center;
        line-height: 1.2;
    }
    
    .room-list li.active { 
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        color: white;
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.3);
    }
    
    /* í”„ë¡œí•„ ì¹´ë“œ */
    .profile-card {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 20px;
        background: linear-gradient(135deg, #FFF7F2, #ffffff);
        border-radius: 16px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 200, 178, 0.3);
    }
    
    .profile-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: white;
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.3);
    }
    
    .profile-info {
        flex: 1;
    }
    
    .profile-name {
        font-weight: 700;
        font-size: 18px;
        color: #1F2937;
        margin-bottom: 4px;
    }
    
    .profile-details {
        font-size: 14px;
        color: #6B7280;
        margin-bottom: 2px;
    }
    
    .profile-bio {
        font-size: 13px;
        color: #9CA3AF;
        margin-top: 8px;
        line-height: 1.4;
    }
    
    .profile-actions {
        display: flex;
        gap: 8px;
    }
    
    .btn-edit {
        padding: 8px 12px;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        font-size: 12px;
        color: #6c757d;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    
    .btn-edit:hover {
        background: #e9ecef;
        border-color: #FF9F80;
        color: #495057;
    }
    
    /* ë§¤ì¹­ ì„¹ì…˜ */
    .matching-grid {
            display: grid; 
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .matching-card {
            background: #fff; 
        border: 1px solid #f0f0f0;
        border-radius: 16px;
        padding: 32px 24px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .matching-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 159, 128, 0.02) 0%, rgba(255, 200, 178, 0.05) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .matching-card:hover::before {
        opacity: 1;
    }
    
    .matching-card:hover {
        border-color: #FF9F80;
        box-shadow: 0 8px 24px rgba(255, 159, 128, 0.15);
        transform: translateY(-4px);
    }
    
    .matching-icon {
        width: 48px;
        height: 48px;
        margin: 0 auto 16px;
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
            border-radius: 12px; 
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        position: relative;
        z-index: 1;
    }
    
    .matching-title {
            font-weight: 700; 
        font-size: 18px;
        margin-bottom: 8px;
        color: #1F2937;
        position: relative;
        z-index: 1;
    }
    
    .matching-desc {
        font-size: 14px;
        color: #6B7280;
        margin-bottom: 24px;
        line-height: 1.5;
        position: relative;
        z-index: 1;
    }
    
    .btn {
        padding: 14px 24px;
        border: none;
        border-radius: 12px;
            cursor: pointer; 
        font-weight: 600;
        font-size: 14px;
            transition: all 0.3s ease;
        width: 100%;
        position: relative;
        z-index: 1;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        color: white;
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 159, 128, 0.4);
        background: linear-gradient(135deg, #FF8A6B, #FFB89D);
    }
    
    .btn-secondary {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
    }
    
    .btn-secondary:hover {
        background: #e9ecef;
        border-color: #adb5bd;
    }
    
    /* ë§¤ì¹­ ìƒíƒœ */
    .matching-status {
        text-align: center;
        padding: 16px;
        display: none;
    }
    
    .matching-spinner {
        width: 24px;
        height: 24px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #FF9F80;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 12px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .matching-text {
        font-weight: 600;
        color: #FF9F80;
        margin-bottom: 8px;
    }
    
    .matching-timer {
        font-size: 14px;
        color: #6B7280;
        margin-bottom: 12px;
    }
    
    /* ì±„íŒ… í™”ë©´ */
        .messages { 
        height: 400px; 
        overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
        gap: 12px;
        padding: 16px;
        background: #fafafa;
        border-radius: 12px;
        margin-bottom: 16px;
        align-items: flex-start;
    }
    
        .msg { 
            max-width: 70%; 
        padding: 12px 16px; 
        border-radius: 16px; 
        background: #fff; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 14px;
        line-height: 1.4;
        position: relative;
        display: inline-block;
        word-wrap: break-word;
    }
    
        .msg.me { 
            align-self: flex-end; 
        background: linear-gradient(135deg, #FF9F80, #FFC8B2); 
            color: #fff; 
        }
        
        .msg-wrapper {
            display: flex;
        width: 100%;
            margin-bottom: 8px;
        }
        
        .msg-wrapper.me {
            justify-content: flex-end;
        }
    
    .msg-content {
        margin-bottom: 4px;
    }
    
    .msg-time {
        font-size: 11px;
        opacity: 0.7;
        text-align: right;
        margin-top: 4px;
    }
    
    .msg-nickname {
        font-size: 12px;
        color: #FF9F80;
        font-weight: 600;
        margin-bottom: 4px;
        display: block;
    }
    
    .msg.me .msg-nickname {
        display: none;
    }
    
    .msg.me .msg-time {
        color: rgba(255, 255, 255, 0.8);
    }
    
    .msg:not(.me) .msg-time {
        color: #999;
    }
    
        .composer { 
            display: flex; 
        gap: 12px; 
        padding: 16px;
        background: #f8f9fa;
        border-radius: 12px;
    }
    
        .composer input { 
        flex: 4; 
        padding: 12px 16px; 
        border: 1px solid #e9ecef; 
            border-radius: 10px; 
        font-size: 14px;
        background: white;
        min-width: 0;
    }
    
    .composer .btn {
        flex: 1;
        min-width: 80px;
        white-space: nowrap;
    }
    
    /* í—¤ë” í™ˆ ë²„íŠ¼ */
    .btn-home {
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
            border: none;
        color: white;
        padding: 8px 12px;
            border-radius: 8px;
        font-size: 13px;
            font-weight: 600;
        cursor: pointer;
            transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(255, 159, 128, 0.3);
    }
    
    .btn-home:hover {
        background: linear-gradient(135deg, #FF8A6B, #FFB89D);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.4);
    }
    
    .btn-home svg {
        width: 14px;
        height: 14px;
    }
    
    /* ì±„íŒ… ì˜µì…˜ ë²„íŠ¼ */
    .btn-options {
        background: transparent;
            border: none;
        color: #6B7280;
        padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .btn-options:hover {
        background: rgba(107, 114, 128, 0.1);
        color: #374151;
    }
    
    /* ì±„íŒ… ì˜µì…˜ ë“œë¡­ë‹¤ìš´ */
    .chat-options-dropdown {
        position: fixed;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        min-width: 200px;
        z-index: 1000;
        overflow: hidden;
    }
    
    .dropdown-header {
        padding: 12px 16px;
        font-size: 14px;
        font-weight: 600;
        color: #374151;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .dropdown-item {
        padding: 12px 16px;
        font-size: 14px;
        color: #374151;
        cursor: pointer;
        display: flex;
        align-items: center;
            gap: 12px;
        transition: background-color 0.2s ease;
    }
    
    .dropdown-item:hover {
        background: #f3f4f6;
    }
    
    .dropdown-item.danger {
        color: #dc2626;
    }
    
    .dropdown-item.danger:hover {
        background: #fef2f2;
    }
    
    .dropdown-divider {
        height: 1px;
        background: #e5e7eb;
        margin: 4px 0;
    }
    
    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
            width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }
    
    .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9fafb;
    }
    
    .modal-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #374151;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #6B7280;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
    }
    
    .modal-close:hover {
        background: #e5e7eb;
        color: #374151;
    }
    
    .modal-body {
            padding: 24px; 
        max-height: 60vh;
        overflow-y: auto;
    }
    
    /* ì°¸ì—¬ì ëª©ë¡ ìŠ¤íƒ€ì¼ */
    .participants-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .participant-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border: 1px solid #e5e7eb;
            border-radius: 12px; 
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
    }
    
    .participant-item:hover {
        border-color: #FF9F80;
        background: #FFF7F2;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.2);
    }
    
    .participant-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
            background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        margin-right: 12px;
    }
    
    .participant-info {
        flex: 1;
    }
    
    .participant-name {
        font-weight: 600;
        color: #374151;
            margin-bottom: 4px;
    }
    
    .participant-status {
        font-size: 12px;
        color: #6B7280;
    }
    
    /* ì°¸ì—¬ì í”„ë¡œí•„ ìŠ¤íƒ€ì¼ */
    .participant-profile {
        text-align: center;
    }
    
    .profile-avatar-large {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
            display: flex; 
        align-items: center;
        justify-content: center;
        font-size: 36px;
        margin: 0 auto 20px;
    }
    
    .profile-details {
        text-align: left;
        margin-top: 20px;
    }
    
    .profile-detail-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .profile-detail-label {
        font-weight: 600;
        color: #6B7280;
    }
    
    .profile-detail-value {
        color: #374151;
    }
    
    /* ëœë¤ ë§¤ì¹­ í”„ë¡œí•„ ì„¹ì…˜ */
    .random-matching-section {
        margin: 24px 0;
    }
    
    .section-header {
        margin-bottom: 16px;
    }
    
    .section-title {
        font-size: 18px;
        font-weight: 700;
        color: #374151;
            display: flex; 
        align-items: center;
            gap: 8px; 
    }
    
    .profile-carousel {
        position: relative;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .carousel-btn {
        background: #f3f4f6;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        color: #6b7280;
        flex-shrink: 0;
    }
    
    .carousel-btn:hover {
        background: #e5e7eb;
        color: #374151;
        transform: scale(1.05);
    }
    
    .profile-cards-container {
        display: flex;
        gap: 16px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding: 8px 0;
            flex: 1; 
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .profile-cards-container::-webkit-scrollbar {
        display: none;
    }
    
    .random-profile-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        min-width: 200px;
        max-width: 200px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        text-align: center;
        transition: all 0.3s ease;
        flex-shrink: 0;
    }
    
    .random-profile-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }
    
    .random-profile-avatar {
        width: 60px;
        height: 60px;
            border-radius: 50%;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 600;
        color: #6b7280;
        margin: 0 auto 12px;
    }
    
    .random-profile-name {
        font-size: 16px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 6px;
    }
    
    .random-profile-details {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 8px;
    }
    
    .random-profile-bio {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 16px;
        line-height: 1.4;
        min-height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .random-profile-btn {
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        color: white;
        border: none;
        border-radius: 8px;
            padding: 8px 16px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
        box-shadow: 0 2px 8px rgba(255, 159, 128, 0.3);
    }
    
    .random-profile-btn:hover {
        background: linear-gradient(135deg, #FF8A6B, #FFB89A);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.4);
    }
    
    /* í”„ë¡œí•„ ìƒì„¸ ëª¨ë‹¬ */
    .profile-detail-content {
        text-align: center;
    }
    
    .profile-detail-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #FFC8B2, #FF9F80);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        font-weight: 600;
        color: white;
        margin: 0 auto 20px;
        box-shadow: 0 8px 22px rgba(255, 159, 128, 0.35);
    }
    
    .profile-detail-name {
        font-size: 24px;
        font-weight: 700;
        color: #1F2937;
        margin-bottom: 8px;
    }
    
    .profile-detail-info {
        font-size: 16px;
        color: #6B7280;
        margin-bottom: 16px;
    }
    
    .profile-detail-bio {
        font-size: 14px;
        color: #374151;
        line-height: 1.6;
        background: #FFF7F2;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid rgba(255, 159, 128, 0.2);
    }
    
    .profile-detail-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
    }
    
    .profile-detail-btn {
        padding: 12px 24px;
            border: none;
            border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
            cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .profile-detail-btn.primary {
        background: linear-gradient(135deg, #FF9F80, #FF8A6B);
        color: white;
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.3);
    }
    
    .profile-detail-btn.primary:hover {
        background: linear-gradient(135deg, #FF8A6B, #FF7A5B);
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(255, 159, 128, 0.4);
    }
    
    .profile-detail-btn.secondary {
        background: #FFF7F2;
        color: #6B7280;
        border: 1px solid rgba(255, 159, 128, 0.3);
    }
    
    .profile-detail-btn.secondary:hover {
        background: #FFC8B2;
        color: #374151;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 159, 128, 0.2);
    }
    
    .profile-detail-interests {
        margin-bottom: 20px;
    }
    
    .profile-detail-interests-title {
        font-size: 14px;
            font-weight: 600;
        color: #6B7280;
        margin-bottom: 8px;
        text-align: center;
    }
    
    .profile-detail-interests-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
    }
    
    .profile-detail-interest-tag {
            background: linear-gradient(135deg, #FF9F80, #FFC8B2);
            color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        box-shadow: 0 2px 6px rgba(255, 159, 128, 0.25);
    }
    
    .composer input:focus {
        outline: none;
        border-color: #FF9F80;
        box-shadow: 0 0 0 3px rgba(255, 159, 128, 0.1);
    }
    
    /* ë§ˆì´í”„ë¡œí•„ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
    .my-profile-content {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }
    
    .my-profile-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #FF9F7C, #FFC8B2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        flex-shrink: 0;
        box-shadow: 0 4px 12px rgba(255, 159, 124, 0.3);
    }
    
    .my-profile-info {
        flex: 1;
        min-width: 0;
    }
    
    .my-profile-name {
        font-size: 14px;
        font-weight: 600;
        color: #1F2937;
        margin-bottom: 4px;
        line-height: 1.3;
    }
    
    .my-profile-details {
        font-size: 12px;
        color: #6B7280;
        margin-bottom: 6px;
        line-height: 1.3;
    }
    
    .my-profile-bio {
        font-size: 12px;
        color: #6B7280;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .my-profile-actions {
        flex-shrink: 0;
        margin-left: auto;
    }
    
    .my-profile-edit-btn {
        background: linear-gradient(135deg, #FF9F7C, #FF7B54);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(255, 159, 124, 0.3);
    }
    
    .my-profile-edit-btn:hover {
        background: linear-gradient(135deg, #FF7B54, #FF9F7C);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 159, 124, 0.4);
    }

    /* ë°˜ì‘í˜• */
        @media(max-width: 900px){ 
            .chat-layout{ 
                grid-template-columns: 1fr; 
                padding: 16px;
            } 
        
        .matching-grid {
            grid-template-columns: 1fr;
        }
        
        .sidebar-column {
            gap: 12px;
            position: static;
            top: auto;
        }
        
        .sidebar-card-header {
            padding: 16px 16px 10px;
        }
        
        .sidebar-card-body {
            padding: 12px 16px 16px;
        }
        
        .my-profile-avatar {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }
        
        .my-profile-name {
            font-size: 13px;
        }
        
        .my-profile-details,
        .my-profile-bio {
            font-size: 11px;
        }
        
        .my-profile-edit-btn {
            padding: 4px 8px;
            font-size: 11px;
        }
    }
    
    /* í†µì¼ëœ Footer ìŠ¤íƒ€ì¼ */
    footer {
        border-top: 1px solid rgba(255, 200, 178, 0.5);
        margin-top: 0;
        padding: 0;
    }
    
    footer > div {
        max-width: 72rem;
        margin: 0 auto;
        padding: 1.5rem 1rem;
        font-size: 0.875rem;
        line-height: 1.25rem;
        color: #6B7280;
        text-align: center;
        }
    </style>
</head>
<body class="bg-cream">
  <div class="top-grad h-[160px] w-full absolute inset-0 -z-10 pointer-events-none"></div>

  <header class="fixed top-0 left-0 right-0 z-50 border-b border-peach/40 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="index.html" class="flex items-center gap-2 font-extrabold text-lg">
        <img src="logo.png" alt="KBU hub" class="w-9 h-9 rounded-full shadow-[0_8px_18px_rgba(255,159,128,.25)]">
        <span>hub</span>
      </a>
      <nav class="ml-auto hidden md:flex">
        <div id="navPill" class="nav-pill">
          <!-- ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì€ navigation.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
      </nav>
      <button id="menuBtn" class="md:hidden ml-auto p-2 rounded-full border border-peach/60">â˜°</button>
    </div>
    <div id="mobileNav" class="hidden md:hidden px-4 pb-3 border-t border-peach/40 bg-white/70">
      <div class="flex flex-col gap-1 py-2 text-sm">
        <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì€ navigation.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </header>

  <main class="chat-layout" style="margin-top: 80px;">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <div class="sidebar-column">
      <!-- ì±„íŒ…ë°© ëª©ë¡ ì¹´ë“œ -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <h2 class="sidebar-card-title">ì±„íŒ…ë°© ëª©ë¡</h2>
        </div>
        <div class="sidebar-card-body">
          <div class="sidebar-section">
            <div class="sidebar-title">1:1</div>
            <ul class="room-list" id="dmList">
              <!-- 1:1 ì±„íŒ…ë°© ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
        </div>
        
          <div class="sidebar-section">
            <div class="sidebar-title">ê·¸ë£¹</div>
            <ul class="room-list" id="groupList">
              <!-- ê·¸ë£¹ ì±„íŒ…ë°© ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
                            </div>
                            
          <div class="sidebar-section">
            <div class="sidebar-title">ê´€ì‹¬ ë¶„ì•¼</div>
            <ul class="room-list" id="interestList">
              <!-- ê´€ì‹¬ì‚¬ ê¸°ë°˜ ì±„íŒ…ë°©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
                                </div>
                            </div>
                        </div>

      <!-- ë§ˆì´í”„ë¡œí•„ ì¹´ë“œ -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <h2 class="sidebar-card-title">ë§ˆì´í”„ë¡œí•„</h2>
                                </div>
        <div class="sidebar-card-body">
          <div class="my-profile-content">
            <div class="my-profile-avatar" id="myProfileAvatar">ğŸ‘¤</div>
            <div class="my-profile-info">
              <div class="my-profile-name" id="myProfileName">ìµëª… í”„ë¡œí•„</div>
              <div class="my-profile-details" id="myProfileDetails">23í•™ë²ˆ Â· ë‚¨ì</div>
              <div class="my-profile-bio" id="myProfileBio">ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!</div>
                            </div>
            <div class="my-profile-actions">
              <button class="my-profile-edit-btn" onclick="window.spaRouter.navigateTo('/profile-setup')">ìˆ˜ì •</button>
                        </div>
          </div>
                                </div>
                            </div>
                        </div>

    <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ ì˜ì—­ -->
    <section class="panel main-panel">
      <div class="panel-header">
        <div class="header-content">
          <div class="header-left">
            <span id="chatHeader">ëœë¤ ë§¤ì¹­</span>
            <span id="participantCount" class="participant-count-header" style="display:none;"></span>
                                </div>
          <div class="header-right">
            <button id="chatOptions" class="btn-options" style="display:none;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="19" cy="12" r="1"/>
                <circle cx="5" cy="12" r="1"/>
              </svg>
                                </button>
            <button id="backToHome" class="btn-home" style="display:none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              í™ˆìœ¼ë¡œ
                                </button>
                                </div>
                            </div>
                        </div>

      <!-- ì±„íŒ… ì˜µì…˜ ë“œë¡­ë‹¤ìš´ -->
      <div id="chatOptionsDropdown" class="chat-options-dropdown" style="display:none;">
        <div class="dropdown-header">ì±„íŒ… ì˜µì…˜</div>
        <div class="dropdown-item" onclick="showParticipants()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          ì°¸ì—¬ì ë³´ê¸°
                        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item danger" onclick="leaveChatRoom()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16,17 21,12 16,7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          ì±„íŒ…ë°© ë‚˜ê°€ê¸°
                            </div>
                </div>
                
      <!-- ì°¸ì—¬ì ë³´ê¸° ëª¨ë‹¬ -->
      <div id="participantsModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ì°¸ì—¬ì ëª©ë¡</h3>
            <button class="modal-close" onclick="closeParticipantsModal()">&times;</button>
                                </div>
          <div class="modal-body">
            <div id="participantsList" class="participants-list">
              <!-- ì°¸ì—¬ì ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                            </div>
            </div>
        
      <!-- ì°¸ì—¬ì í”„ë¡œí•„ ëª¨ë‹¬ -->
      <div id="participantProfileModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ì°¸ì—¬ì í”„ë¡œí•„</h3>
            <button class="modal-close" onclick="closeParticipantProfileModal()">&times;</button>
                </div>
          <div class="modal-body">
            <div id="participantProfileContent" class="participant-profile">
              <!-- ì°¸ì—¬ì í”„ë¡œí•„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
          </div>
                        </div>
                        </div>

      <!-- í”„ë¡œí•„ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
      <div id="profileDetailModal" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>í”„ë¡œí•„ ìƒì„¸</h3>
            <button class="modal-close" onclick="closeProfileDetailModal()">&times;</button>
                                            </div>
          <div class="modal-body">
            <div id="profileDetailContent" class="profile-detail-content">
              <!-- í”„ë¡œí•„ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                                <div class="panel-body">
        <!-- ê¸°ë³¸ í™”ë©´: í”„ë¡œí•„ + ë§¤ì¹­ ì˜µì…˜ -->
                    <div id="chatContent">

          <!-- ëœë¤ ë§¤ì¹­ í”„ë¡œí•„ ì„¹ì…˜ -->
          <div class="random-matching-section">
            <div class="section-header">
              <span class="section-title">âœ¨ ëœë¤ ë§¤ì¹­ í”„ë¡œí•„</span>
                                            </div>
            <div class="profile-carousel">
              <button class="carousel-btn prev-btn" onclick="scrollProfiles(-1)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15,18 9,12 15,6"/>
                </svg>
              </button>
              <div class="profile-cards-container" id="profileCardsContainer">
                <!-- í”„ë¡œí•„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                                        </div>
              <button class="carousel-btn next-btn" onclick="scrollProfiles(1)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9,18 15,12 9,6"/>
                </svg>
              </button>
                                    </div>
                                </div>

          <!-- ë§¤ì¹­ ì˜µì…˜ -->
          <div class="matching-grid">
            <div class="matching-card">
              <div class="matching-icon">ğŸ’¬</div>
              <div class="matching-title">ëœë¤ 1:1 ëŒ€í™”</div>
              <div class="matching-desc">ìµëª…ìœ¼ë¡œ í•œ ëª…ê³¼ ì—°ê²°ë©ë‹ˆë‹¤.</div>
              <button id="startRandom" class="btn btn-primary">1:1 ë§¤ì¹­ ì‹œì‘</button>
              <div id="randomMatchingStatus" class="matching-status">
                                                <div class="matching-spinner"></div>
                <div class="matching-text">ë§¤ì¹­ ì¤‘...</div>
                <div class="matching-timer" id="randomTimer">00:00:00</div>
                <button id="cancelRandom" class="btn btn-secondary">ë§¤ì¹­ ì·¨ì†Œ</button>
                                    </div>
                                        </div>
            
            <div class="matching-card">
              <div class="matching-icon">ğŸ‘¥</div>
              <div class="matching-title">ëœë¤ ê·¸ë£¹ ëŒ€í™”</div>
              <div class="matching-desc">3-6ëª…ì´ ëœë¤ìœ¼ë¡œ ëª¨ì—¬ ëŒ€í™”í•©ë‹ˆë‹¤.</div>
              <button id="startGroup" class="btn btn-primary">ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘</button>
              <div id="groupMatchingStatus" class="matching-status">
                                                <div class="matching-spinner"></div>
                <div class="matching-text">ë§¤ì¹­ ì¤‘...</div>
                <div class="matching-timer" id="groupTimer">00:00:00</div>
                <button id="cancelGroup" class="btn btn-secondary">ë§¤ì¹­ ì·¨ì†Œ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
        <!-- ì±„íŒ… í™”ë©´ -->
                    <div id="chatRoom" style="display:none;">
                        <div class="messages" id="messages">
            <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <div class="composer">
                            <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                            <button id="sendButton" class="btn btn-primary">ì „ì†¡</button>
                        </div>
                    </div>
                </div>
            </section>
    </main>

  <footer>
    <div>
      Â© <span id="year"></span> KBU hub Â· All rights reserved.
        </div>
    </footer>

    <script>
    // ìµëª… í”„ë¡œí•„ ë¡œë“œ
    function loadAnonProfile() {
      try {
        const profile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
        if (profile) {
          // ë§ˆì´í”„ë¡œí•„ ì¹´ë“œ ì—…ë°ì´íŠ¸
          document.getElementById('myProfileName').textContent = profile.nickname || 'ìµëª…ì˜ì¹œêµ¬';
          document.getElementById('myProfileDetails').textContent = `${profile.year}í•™ë²ˆ Â· ${profile.gender}`;
          document.getElementById('myProfileBio').textContent = profile.bio || 'ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!';
          
          // ê´€ì‹¬ì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
          updateInterestList(profile.interests || []);
          
          // ë§¤ì¹­ ë²„íŠ¼ í™œì„±í™”
          document.getElementById('startRandom').textContent = '1:1 ë§¤ì¹­ ì‹œì‘';
          document.getElementById('startGroup').textContent = 'ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘';
        } else { 
          // ê¸°ë³¸ê°’ ì„¤ì •
          document.getElementById('myProfileName').textContent = 'ìµëª… í”„ë¡œí•„';
          document.getElementById('myProfileDetails').textContent = '23í•™ë²ˆ Â· ë‚¨ì';
          document.getElementById('myProfileBio').textContent = 'ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!';
          
          // ê´€ì‹¬ì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
          updateInterestList([]);
          
          // ë§¤ì¹­ ë²„íŠ¼ í™œì„±í™”
          document.getElementById('startRandom').textContent = '1:1 ë§¤ì¹­ ì‹œì‘';
          document.getElementById('startGroup').textContent = 'ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘';
        }
      } catch (e) {
        console.error('í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:', e);
        // ê¸°ë³¸ê°’ ì„¤ì •
        document.getElementById('myProfileName').textContent = 'ìµëª… í”„ë¡œí•„';
        document.getElementById('myProfileDetails').textContent = '23í•™ë²ˆ Â· ë‚¨ì';
        document.getElementById('myProfileBio').textContent = 'ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!';
      }
    }

    // ê´€ì‹¬ì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updateInterestList(interests) {
      const interestList = document.getElementById('interestList');
      interestList.innerHTML = '';
      
            if (interests.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'ì„ íƒí•œ ê´€ì‹¬ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.';
        li.style.color = '#999';
        li.style.cursor = 'default';
        interestList.appendChild(li);
                return;
            }
            
      // ê´€ì‹¬ì‚¬ë³„ ì´ëª¨ì§€ ë§¤í•‘
      const interestEmojis = {
        'ì˜í™”': 'ğŸ¬',
        'ìš´ë™': 'ğŸ’ª',
        'ê²Œì„': 'ğŸ®',
        'ìŒì•…': 'ğŸµ',
        'ì¹´í˜': 'â˜•',
        'ì—¬í–‰': 'âœˆï¸',
        'ìŠ¤í„°ë””': 'ğŸ“š',
        'ë…ì„œ': 'ğŸ“–',
        'ë§›ì§‘': 'ğŸ½ï¸'
      };
      
      interests.forEach(interest => {
                const li = document.createElement('li');
        const emoji = interestEmojis[interest] || 'ğŸ¯';
        const participantCount = roomParticipants[interest]?.count || 0;
        
        // ê´€ì‹¬ë¶„ì•¼ í•­ëª© HTML êµ¬ì¡° (ì±„íŒ…ë°© ëª©ë¡ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼)
        li.innerHTML = `
            <div class="room-info">
                <div class="room-name-wrapper">
                    <span class="room-name">${emoji} ${interest}</span>
                </div>
                <span class="participant-count">${participantCount}ëª…</span>
            </div>
        `;
        
        li.addEventListener('click', () => {
            // ê´€ì‹¬ì‚¬ ë°© ì…ì¥ ì‹œ ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€
            addInterestRoom(interest);
            enterRoom(interest);
            
            // í´ë¦­ëœ ê´€ì‹¬ë¶„ì•¼ì— active í´ë˜ìŠ¤ ì¶”ê°€ (ë¹„ì£¼ì–¼ ìŠ¤íƒ€ì¼ ì ìš©)
            document.querySelectorAll('#interestList li').forEach(item => {
                item.classList.remove('active');
            });
            li.classList.add('active');
        });
                interestList.appendChild(li);
            });
    }

    // ê´€ì‹¬ì‚¬ ë°©ì„ ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€
    function addInterestRoom(interest) {
        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°©ì¸ì§€ í™•ì¸
        const existingRoom = chatData.roomList.find(room => room.name === interest);
        if (!existingRoom) {
            // ì±„íŒ…ë°© ë°ì´í„°ì— ì¶”ê°€
            if (!chatData.rooms[interest]) {
                chatData.rooms[interest] = [];
            }
            
            // ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€
            chatData.roomList.push({
                name: interest,
                type: 'interest',
                unreadCount: 0,
                participantCount: roomParticipants[interest]?.count || 0,
                createdAt: new Date().toISOString()
            });
            
            saveChatData();
            updateRoomListUI();
        } else {
            // ê¸°ì¡´ ë°©ì¸ ê²½ìš° ì°¸ì—¬ì ìˆ˜ ì¦ê°€
            incrementParticipantCount(interest);
        }
    }

    // ê´€ì‹¬ë¶„ì•¼ ë°© ì°¸ì—¬ì ìˆ˜ ì¦ê°€
    function incrementParticipantCount(interest) {
        if (roomParticipants[interest]) {
            roomParticipants[interest].count += 1;
            // ì±„íŒ…ë°© ëª©ë¡ì˜ ì°¸ì—¬ì ìˆ˜ ì—…ë°ì´íŠ¸
            const roomData = chatData.roomList.find(room => room.name === interest);
            if (roomData) {
                roomData.participantCount = roomParticipants[interest].count;
                saveChatData();
                updateRoomListUI();
                updateInterestListUI(interest);
            }
        }
    }

    // ê´€ì‹¬ë¶„ì•¼ ëª©ë¡ UI ì—…ë°ì´íŠ¸
    function updateInterestListUI(interest) {
        const interestList = document.getElementById('interestList');
        const listItems = interestList.querySelectorAll('li');
        
        listItems.forEach(li => {
            const roomNameSpan = li.querySelector('.room-name');
            if (roomNameSpan && roomNameSpan.textContent.includes(interest)) {
                const participantCountSpan = li.querySelector('.participant-count');
                if (participantCountSpan) {
                    const currentCount = roomParticipants[interest]?.count || 0;
                    participantCountSpan.textContent = `${currentCount}ëª…`;
                }
            }
        });
    }

    // ê¸°ë³¸ ê´€ì‹¬ë¶„ì•¼ ë°©ë“¤ì„ ì´ˆê¸°í™”
    function initializeDefaultInterestRooms() {
        const defaultInterests = ['ìš´ë™', 'ë…ì„œ']; // ì´ë¯¸ì§€ì— ë³´ì´ëŠ” ê¸°ë³¸ ê´€ì‹¬ë¶„ì•¼ë“¤
        
        defaultInterests.forEach(interest => {
            addInterestRoom(interest);
        });
    }


    // ë§¤ì¹­ ê´€ë ¨ ë³€ìˆ˜
        let randomMatching = false;
        let groupMatching = false;
        let randomStartTime = null;
        let groupStartTime = null;
        let randomTimer = null;
        let groupTimer = null;
        
        // ê·¸ë£¹ ë§¤ì¹­ ëŒ€ê¸°ì—´ (ì „ì—­)
        let groupMatchingQueue = {
            male: [], // ë‚¨ì ëŒ€ê¸°ì ëª©ë¡
            female: [], // ì—¬ì ëŒ€ê¸°ì ëª©ë¡
            groups: [] // ì™„ì„±ëœ ê·¸ë£¹ ëª©ë¡
        };
        
        // ì±„íŒ… ë°ì´í„° ì €ì¥ì†Œ (ì „ì—­)
        let chatData = {
            rooms: {}, // ì±„íŒ…ë°©ë³„ ë©”ì‹œì§€ ì €ì¥
            roomList: [] // ì±„íŒ…ë°© ëª©ë¡
        };

    // íƒ€ì´ë¨¸ í¬ë§·íŒ…
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ì±„íŒ… ë°ì´í„° ì €ì¥
        function saveChatData() {
            try {
                localStorage.setItem('chatData', JSON.stringify(chatData));
            } catch (e) {
                console.error('ì±„íŒ… ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }

        // ì±„íŒ… ë°ì´í„° ë¡œë“œ
        function loadChatData() {
            try {
                const saved = localStorage.getItem('chatData');
                if (saved) {
                    chatData = JSON.parse(saved);
                }
            } catch (e) {
                console.error('ì±„íŒ… ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                chatData = { rooms: {}, roomList: [] };
            }
        }

        // ì±„íŒ…ë°© ëª©ë¡ UI ì—…ë°ì´íŠ¸
        function updateRoomListUI() {
            // 1:1 ì±„íŒ…ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
            const dmList = document.getElementById('dmList');
            dmList.innerHTML = '';
            
            // ê·¸ë£¹ ì±„íŒ…ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
            const groupList = document.getElementById('groupList');
            groupList.innerHTML = '';
            
            // ê´€ì‹¬ë¶„ì•¼ ì±„íŒ…ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
            const interestList = document.getElementById('interestList');
            interestList.innerHTML = '';
            
            chatData.roomList.forEach(room => {
                if (room.type === 'dm') {
                    createRoomListItem('dmList', room.name, room.unreadCount || 0);
                } else if (room.type === 'group') {
                    createRoomListItem('groupList', room.name, room.unreadCount || 0, room.participantCount || 0);
                } else if (room.type === 'interest') {
                    createRoomListItem('interestList', room.name, room.unreadCount || 0, room.participantCount || 0);
                }
            });
        }

        // ì±„íŒ…ë°© ëª©ë¡ ì•„ì´í…œ ìƒì„±
        function createRoomListItem(listId, roomName, unreadCount = 0, participantCount = 0) {
            const list = document.getElementById(listId);
            const li = document.createElement('li');
            const isGroupChat = listId === 'groupList' || listId === 'interestList';
            const isInterestRoom = listId === 'interestList';
            
            // ê´€ì‹¬ë¶„ì•¼ ë°©ì¸ ê²½ìš° ì´ëª¨ì§€ ì¶”ê°€
            let displayName = roomName;
            if (isInterestRoom) {
                const interestEmojis = {
                    'ìš´ë™': 'ğŸ’ª',
                    'ê²Œì„': 'ğŸ®',
                    'ìŒì•…': 'ğŸµ',
                    'ì˜í™”': 'ğŸ¬',
                    'ìš”ë¦¬': 'ğŸ‘¨â€ğŸ³',
                    'ì—¬í–‰': 'âœˆï¸',
                    'ìŠ¤í„°ë””': 'ğŸ“š',
                    'ë…ì„œ': 'ğŸ“–',
                    'ë§›ì§‘': 'ğŸ½ï¸'
                };
                const emoji = interestEmojis[roomName] || 'ğŸ¯';
                displayName = `${emoji} ${roomName}`;
            }
            
            li.innerHTML = `
                <div class="room-info">
                    <div class="room-name-wrapper">
                        <span class="room-name">${displayName}</span>
                        ${unreadCount > 0 ? `<span class="unread-badge">${unreadCount}</span>` : ''}
                    </div>
                    ${isGroupChat ? `<span class="participant-count">${participantCount}ëª…</span>` : ''}
                </div>
            `;
            li.addEventListener('click', () => {
                enterRoom(roomName);
                
                // ê´€ì‹¬ë¶„ì•¼ ë°©ì¸ ê²½ìš° ë¹„ì£¼ì–¼ ìŠ¤íƒ€ì¼ ì ìš©
                if (isInterestRoom) {
                    document.querySelectorAll('#interestList li').forEach(item => {
                        item.classList.remove('active');
                    });
                    li.classList.add('active');
                }
            });
            list.appendChild(li);
        }

        // 1:1 ë§¤ì¹­ ì‹œì‘
        function startRandomMatching() {
            // í˜„ì¬ ì‚¬ìš©ìì˜ ì„±ë³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const currentProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
            const currentUserGender = currentProfile?.gender || 'ë‚¨ì';
            
            // ì´ì„± í”„ë¡œí•„ë§Œ í•„í„°ë§
            const oppositeGenderProfiles = randomProfiles.filter(profile => 
                profile.gender !== currentUserGender
            );
            
            // ì´ì„± í”„ë¡œí•„ì´ ì—†ëŠ” ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
            if (oppositeGenderProfiles.length === 0) {
                alert('í˜„ì¬ ë§¤ì¹­ ê°€ëŠ¥í•œ ìƒëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            randomMatching = true;
            randomStartTime = Date.now();
      document.getElementById('startRandom').style.display = 'none';
      document.getElementById('randomMatchingStatus').style.display = 'block';
            
            randomTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - randomStartTime) / 1000);
        document.getElementById('randomTimer').textContent = formatTime(elapsed);
            }, 1000);

      // ì‹œì—°ìš©: 5-10ì´ˆ í›„ ë§¤ì¹­ ì™„ë£Œ (ì´ì„± í”„ë¡œí•„ ì¤‘ì—ì„œë§Œ ì„ íƒ)
      setTimeout(() => {
        completeRandomMatching(oppositeGenderProfiles);
      }, Math.random() * 5000 + 5000);
        }

        // ê·¸ë£¹ ë§¤ì¹­ ì‹œì‘
        function startGroupMatching() {
            // í˜„ì¬ ì‚¬ìš©ìì˜ ì„±ë³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const currentProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
            const currentUserGender = currentProfile?.gender || 'ë‚¨ì';
            const currentUserNickname = currentProfile?.nickname || 'ìµëª…ì˜ì¹œêµ¬';
            
            // ëŒ€ê¸°ì—´ì— ì‚¬ìš©ì ì¶”ê°€
            const userInfo = {
                nickname: currentUserNickname,
                gender: currentUserGender,
                joinTime: Date.now()
            };
            
            if (currentUserGender === 'ë‚¨ì') {
                groupMatchingQueue.male.push(userInfo);
            } else {
                groupMatchingQueue.female.push(userInfo);
            }
            
            groupMatching = true;
            groupStartTime = Date.now();
      document.getElementById('startGroup').style.display = 'none';
      document.getElementById('groupMatchingStatus').style.display = 'block';
            
            groupTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - groupStartTime) / 1000);
        document.getElementById('groupTimer').textContent = formatTime(elapsed);
                
                // ëŒ€ê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
                updateGroupMatchingStatus();
            }, 1000);

            // ê·¸ë£¹ ë§¤ì¹­ ì‹œë„
            tryGroupMatching();
        }

        // 1:1 ë§¤ì¹­ ì™„ë£Œ
        function completeRandomMatching(availableProfiles = null) {
            randomMatching = false;
            clearInterval(randomTimer);
            document.getElementById('startRandom').style.display = 'block';
            document.getElementById('randomMatchingStatus').style.display = 'none';
            
            let matchedProfile;
            
            if (availableProfiles && availableProfiles.length > 0) {
                // ì´ì„± í”„ë¡œí•„ ì¤‘ì—ì„œ ëœë¤ ì„ íƒ
                matchedProfile = availableProfiles[Math.floor(Math.random() * availableProfiles.length)];
            } else {
                // ê¸°ì¡´ ë¡œì§ (ì´ì„± í•„í„°ë§ì´ ì—†ëŠ” ê²½ìš°)
                const nicknames = ['ìµëª…ì˜ì¹œêµ¬', 'ìµëª…ì˜í•™ìƒ', 'ìµëª…ì˜ë™ë£Œ', 'ì‹ ë¹„í•œì¹œêµ¬', 'ì•Œìˆ˜ì—†ëŠ”ëˆ„êµ°ê°€'];
                const randomNickname = nicknames[Math.floor(Math.random() * nicknames.length)];
                matchedProfile = { name: randomNickname };
            }
            
            const roomName = matchedProfile.name;
            
            // ì±„íŒ…ë°© ë°ì´í„°ì— ì¶”ê°€
            if (!chatData.rooms[roomName]) {
                chatData.rooms[roomName] = [];
            }
            
            // ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€ (ì¤‘ë³µ ì²´í¬)
            const existingRoom = chatData.roomList.find(room => room.name === roomName);
            if (!existingRoom) {
                chatData.roomList.push({
                    name: roomName,
                    type: 'dm',
                    unreadCount: 0,
                    createdAt: new Date().toISOString()
                });
                saveChatData();
            }
            
            updateRoomListUI();
            alert('1:1 ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ê·¸ë£¹ ë§¤ì¹­ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateGroupMatchingStatus() {
            const maleCount = groupMatchingQueue.male.length;
            const femaleCount = groupMatchingQueue.female.length;
            const totalCount = maleCount + femaleCount;
            
            const matchingText = document.querySelector('#groupMatchingStatus .matching-text');
            if (matchingText) {
                if (totalCount < 3) {
                    matchingText.textContent = `ë§¤ì¹­ ì¤‘... (ëŒ€ê¸°ì: ë‚¨ì ${maleCount}ëª…, ì—¬ì ${femaleCount}ëª…)`;
                } else {
                    matchingText.textContent = `ë¹„ìœ¨ ë§ì¶¤ ì¤‘... (ëŒ€ê¸°ì: ë‚¨ì ${maleCount}ëª…, ì—¬ì ${femaleCount}ëª…)`;
                }
            }
        }

        // ê·¸ë£¹ ë§¤ì¹­ ì‹œë„ (ë‚¨ë…€ ë¹„ìœ¨ ì²´í¬)
        function tryGroupMatching() {
            const maleCount = groupMatchingQueue.male.length;
            const femaleCount = groupMatchingQueue.female.length;
            const totalCount = maleCount + femaleCount;
            
            // ìµœì†Œ 3ëª… ì´ìƒì´ì–´ì•¼ ê·¸ë£¹ ë§¤ì¹­ ê°€ëŠ¥
            if (totalCount < 3) {
                // ëŒ€ê¸° ìƒíƒœ ìœ ì§€
                setTimeout(() => {
                    if (groupMatching) {
                        tryGroupMatching();
                    }
                }, 2000);
                return;
            }
            
            // ë‚¨ë…€ ë¹„ìœ¨ ì²´í¬ (5:5 ~ 2:1 ë²”ìœ„)
            let canFormGroup = false;
            let groupMembers = [];
            
            // ê°€ëŠ¥í•œ ê·¸ë£¹ ì¡°í•© ì°¾ê¸°
            for (let groupSize = 3; groupSize <= 6; groupSize++) {
                for (let maleInGroup = 1; maleInGroup <= groupSize - 1; maleInGroup++) {
                    const femaleInGroup = groupSize - maleInGroup;
                    
                    // ë¹„ìœ¨ ì²´í¬: 5:5 ~ 2:1 ë²”ìœ„
                    const ratio = Math.max(maleInGroup, femaleInGroup) / Math.min(maleInGroup, femaleInGroup);
                    if (ratio <= 2 && maleInGroup <= maleCount && femaleInGroup <= femaleCount) {
                        canFormGroup = true;
                        
                        // ê·¸ë£¹ ë©¤ë²„ ì„ íƒ (ëŒ€ê¸°ì—´ì—ì„œ ì œê±°)
                        groupMembers = [
                            ...groupMatchingQueue.male.splice(0, maleInGroup),
                            ...groupMatchingQueue.female.splice(0, femaleInGroup)
                        ];
                        break;
                    }
                }
                if (canFormGroup) break;
            }
            
            if (canFormGroup && groupMembers.length > 0) {
                // ê·¸ë£¹ ë§¤ì¹­ ì™„ë£Œ
                completeGroupMatching(groupMembers);
            } else {
                // ë¹„ìœ¨ì´ ë§ì§€ ì•Šì•„ ëŒ€ê¸°
                setTimeout(() => {
                    if (groupMatching) {
                        tryGroupMatching();
                    }
                }, 2000);
            }
        }

        // ê·¸ë£¹ ë§¤ì¹­ ì™„ë£Œ (3-6ëª… ì œí•œ, ë‚¨ë…€ ë¹„ìœ¨ ìœ ì§€)
        function completeGroupMatching(groupMembers) {
            groupMatching = false;
            clearInterval(groupTimer);
            document.getElementById('startGroup').style.display = 'block';
            document.getElementById('groupMatchingStatus').style.display = 'none';
            
            const groupNumber = chatData.roomList.filter(room => room.type === 'group').length + 1;
            const participantCount = groupMembers.length;
            
            // ê·¸ë£¹ ëœë¤ ì±„íŒ…ìš© ì°¸ì—¬ì ì •ë³´ ìƒì„±
            const groupRoomName = `ê·¸ë£¹ ${groupNumber}`;
            roomParticipants[groupRoomName] = {
                count: participantCount,
                users: groupMembers.map(member => member.nickname),
                unreadCount: 0
            };
            
            // ì™„ì„±ëœ ê·¸ë£¹ì„ ëŒ€ê¸°ì—´ì— ì €ì¥
            groupMatchingQueue.groups.push({
                roomName: groupRoomName,
                members: groupMembers,
                createdAt: Date.now()
            });
            
            // ì±„íŒ…ë°© ë°ì´í„°ì— ì¶”ê°€
            if (!chatData.rooms[groupRoomName]) {
                chatData.rooms[groupRoomName] = [];
            }
            
            // ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€
            chatData.roomList.push({
                name: groupRoomName,
                type: 'group',
                unreadCount: 0,
                participantCount: participantCount,
                createdAt: new Date().toISOString()
            });
            
            saveChatData();
            updateRoomListUI();
            
            // ë‚¨ë…€ ë¹„ìœ¨ ì •ë³´ í‘œì‹œ
            const maleCount = groupMembers.filter(m => m.gender === 'ë‚¨ì').length;
            const femaleCount = groupMembers.filter(m => m.gender === 'ì—¬ì').length;
            alert(`ê·¸ë£¹ ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (${participantCount}ëª…, ë‚¨ì ${maleCount}ëª…, ì—¬ì ${femaleCount}ëª…)`);
        }

        // ë§¤ì¹­ ì·¨ì†Œ
        function cancelRandomMatching() {
            randomMatching = false;
            clearInterval(randomTimer);
      document.getElementById('startRandom').style.display = 'block';
      document.getElementById('randomMatchingStatus').style.display = 'none';
        }

        function cancelGroupMatching() {
            // í˜„ì¬ ì‚¬ìš©ìë¥¼ ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
            const currentProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
            const currentUserNickname = currentProfile?.nickname || 'ìµëª…ì˜ì¹œêµ¬';
            
            // ë‚¨ì ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
            groupMatchingQueue.male = groupMatchingQueue.male.filter(user => user.nickname !== currentUserNickname);
            // ì—¬ì ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
            groupMatchingQueue.female = groupMatchingQueue.female.filter(user => user.nickname !== currentUserNickname);
            
            groupMatching = false;
            clearInterval(groupTimer);
      document.getElementById('startGroup').style.display = 'block';
      document.getElementById('groupMatchingStatus').style.display = 'none';
    }

    // ì±„íŒ…ë°© ìƒì„±
    function createRoom(listId, roomName) {
      const list = document.getElementById(listId);
      const li = document.createElement('li');
      const participantCount = roomParticipants[roomName]?.count || 0;
      const unreadCount = roomParticipants[roomName]?.unreadCount || 0;
      
      // 1:1 ì±„íŒ…ì¸ì§€ ê·¸ë£¹ ì±„íŒ…ì¸ì§€ êµ¬ë¶„
      const isGroupChat = listId === 'roomList';
      
      li.innerHTML = `
        <div class="room-info">
          <div class="room-name-wrapper">
            <span class="room-name">${roomName}</span>
            ${unreadCount > 0 ? `<span class="unread-badge">${unreadCount}</span>` : ''}
          </div>
          ${isGroupChat ? `<span class="participant-count">${participantCount}ëª…</span>` : ''}
        </div>
      `;
      li.addEventListener('click', () => enterRoom(roomName));
      list.appendChild(li);
    }

        // í˜„ì¬ í™œì„± ì±„íŒ…ë°©
        let currentRoom = null;
        
        // ëœë¤ ë§¤ì¹­ í”„ë¡œí•„ ë°ì´í„°
        const randomProfiles = [
            { name: 'ì•ˆë…•', year: '23í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ë‚˜ë„ ì¢‹ì•„', avatar: 'ì•ˆ', interests: ['ìš´ë™', 'ìŒì•…'] },
            { name: 'ë¯¼ì§€', year: '22í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ë…ì„œì™€ ì¹´í˜ ì¢‹ì•„í•´ìš”', avatar: 'ë¯¼', interests: ['ë…ì„œ', 'ì˜í™”'] },
            { name: 'ì² ìˆ˜', year: '21í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ìš´ë™ ê°™ì´ í•˜ì‹¤ ë¶„!', avatar: 'ì² ', interests: ['ìš´ë™', 'ê²Œì„'] },
            { name: 'ì§€í˜„', year: '24í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ì˜í™” ë•í›„ì—ìš”', avatar: 'ì§€', interests: ['ì˜í™”', 'ìŒì•…'] },
            { name: 'ì¤€í˜¸', year: '23í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ê²Œì„ ì¢‹ì•„í•´ìš”', avatar: 'ì¤€', interests: ['ê²Œì„', 'ìš´ë™'] },
            { name: 'ìˆ˜ì§„', year: '22í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ìš”ë¦¬ ë°°ìš°ê³  ì‹¶ì–´ìš”', avatar: 'ìˆ˜', interests: ['ìš”ë¦¬', 'ë…ì„œ'] }
        ];
        
        // ì±„íŒ…ë°©ë³„ ì°¸ì—¬ì ì •ë³´ (ê´€ì‹¬ì‚¬ë³„ ê·¸ë£¹ ì±„íŒ… - ì¸ì›ìˆ˜ ì œí•œ ì—†ìŒ)
        const roomParticipants = {
            'ìš´ë™': {
                count: 12,
                users: ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ìµœì§€ì˜', 'ì •í˜„ìš°', 'í•œì†Œì˜', 'ìœ¤íƒœí˜¸', 'ê°•ë¯¸ë˜', 'ì„ë™í˜„', 'ì„œìœ ì§„', 'ì¡°ì„±ë¯¼', 'ë°°ìˆ˜ì§„'],
                unreadCount: 0
            },
            'ê²Œì„': {
                count: 8,
                users: ['ìµœì¤€í˜¸', 'ê¹€ê°€ì€', 'ì´í˜„ìˆ˜', 'ë°•ì„œì—°', 'ì •ë¯¼ì¬', 'í•œì§€ì€', 'ìœ¤ì„±í˜¸', 'ê°•ë‹¤ì€'],
                unreadCount: 0
            },
            'ìŒì•…': {
                count: 15,
                users: ['ê¹€í•˜ëŠ˜', 'ì´ì¤€ì„œ', 'ë°•ì˜ˆë¦°', 'ìµœë¯¼ì„', 'ì •ì†Œì˜', 'í•œì§€í›ˆ', 'ìœ¤ì„œí˜„', 'ê°•ë¯¼ì§€', 'ì„íƒœí˜„', 'ì„œìœ ë‚˜', 'ì¡°í˜„ìš°', 'ë°°ì„œì˜', 'ê¹€ë„í˜„', 'ì´ìˆ˜ì§„', 'ë°•ì¬ë¯¼'],
                unreadCount: 0
            },
            'ì˜í™”': {
                count: 10,
                users: ['ìµœìœ ì§„', 'ê¹€íƒœë¯¼', 'ì´ì„œì˜', 'ë°•ì¤€í˜¸', 'ì •ë¯¸ë˜', 'í•œë™í˜„', 'ìœ¤ì†Œì˜', 'ê°•í˜„ìš°', 'ì„ì§€ì€', 'ì„œë¯¼ìˆ˜'],
                unreadCount: 0
            },
            'ë…ì„œ': {
                count: 7,
                users: ['ì¡°ì˜ˆì¤€', 'ë°°ì„œí˜„', 'ê¹€ë¯¼ì¬', 'ì´ìœ ì§„', 'ë°•í˜„ìˆ˜', 'ìµœì§€ì˜', 'í•œíƒœí˜¸'],
                unreadCount: 0
            },
            'ìš”ë¦¬': {
                count: 9,
                users: ['ìœ¤ì†Œì˜', 'ê°•ë¯¼ìˆ˜', 'ì„ì§€í›ˆ', 'ì„œì˜ˆë¦°', 'ì¡°í˜„ìš°', 'ë°°ë‹¤ì€', 'ê¹€íƒœí˜„', 'ì´ì„œì˜', 'ë°•ì¤€í˜¸'],
                unreadCount: 0
            }
        };

        // ì±„íŒ…ë°© ì…ì¥
        function enterRoom(roomName) {
            currentRoom = roomName;
            document.getElementById('chatHeader').textContent = roomName;
            document.getElementById('chatContent').style.display = 'none';
            document.getElementById('chatRoom').style.display = 'block';
            
            // ê´€ì‹¬ë¶„ì•¼ ë°©ì¸ ê²½ìš° ì°¸ì—¬ì ìˆ˜ ì¦ê°€
            const roomData = chatData.roomList.find(room => room.name === roomName);
            if (roomData && roomData.type === 'interest') {
                incrementParticipantCount(roomName);
            }
            
            // ì°¸ì—¬ì ìˆ˜ í‘œì‹œ (ê·¸ë£¹ ì±„íŒ…ë°©ì¸ ê²½ìš°ì—ë§Œ)
            const participantCount = roomParticipants[roomName]?.count || 0;
            const participantCountElement = document.getElementById('participantCount');
            
            if (roomParticipants[roomName]) {
                // ê·¸ë£¹ ì±„íŒ…ë°©
                participantCountElement.textContent = `í˜„ì¬ ${participantCount}ëª… ì°¸ì—¬ì¤‘`;
                participantCountElement.style.display = 'block';
            } else {
                // 1:1 ì±„íŒ…ë°©
                participantCountElement.textContent = `1:1 ì±„íŒ…`;
                participantCountElement.style.display = 'block';
            }
            
            // ë²„íŠ¼ë“¤ í‘œì‹œ
            document.getElementById('backToHome').style.display = 'inline-flex';
            document.getElementById('chatOptions').style.display = 'inline-flex';
            
            // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì´ˆê¸°í™”
            if (roomParticipants[roomName]) {
                roomParticipants[roomName].unreadCount = 0;
                updateRoomUnreadCount(roomName);
            }
            
            // ì±„íŒ…ë°© ëª©ë¡ì—ì„œ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì´ˆê¸°í™”
            if (roomData) {
                roomData.unreadCount = 0;
                saveChatData();
                updateRoomListUI();
            }
            
            // í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.room-list li, #dmList li').forEach(li => {
                li.classList.remove('active');
                if (li.textContent.includes(roomName)) {
                    li.classList.add('active');
                }
            });
            
            // ì €ì¥ëœ ë©”ì‹œì§€ ë¡œë“œ
            loadRoomMessages(roomName);
        }

        // ì±„íŒ…ë°© ë©”ì‹œì§€ ë¡œë“œ
        function loadRoomMessages(roomName) {
            const messages = document.getElementById('messages');
            messages.innerHTML = '';
            
            if (chatData.rooms[roomName] && chatData.rooms[roomName].length > 0) {
                // ì €ì¥ëœ ë©”ì‹œì§€ í‘œì‹œ
                chatData.rooms[roomName].forEach(messageData => {
                    const messageWrapper = document.createElement('div');
                    messageWrapper.className = `msg-wrapper ${messageData.isMe ? 'me' : ''}`;
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `msg ${messageData.isMe ? 'me' : ''}`;
                    
                    if (messageData.isMe) {
                        // ë‚´ ë©”ì‹œì§€
                        messageDiv.innerHTML = `
                            <div class="msg-content">${messageData.text}</div>
                            <div class="msg-time">${messageData.timeString}</div>
                        `;
                    } else {
                        // ìƒëŒ€ë°© ë©”ì‹œì§€
                        messageDiv.innerHTML = `
                            <div class="msg-nickname">${messageData.nickname}</div>
                            <div class="msg-content">${messageData.text}</div>
                            <div class="msg-time">${messageData.timeString}</div>
                        `;
                    }
                    
                    messageWrapper.appendChild(messageDiv);
                    messages.appendChild(messageWrapper);
                });
            } else {
                // ì²« ì…ì¥ ë©”ì‹œì§€
                addMessage('ì±„íŒ…ë°©ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.', false);
            }
            
            messages.scrollTop = messages.scrollHeight;
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message && currentRoom) {
        addMessage(message, true);
                messageInput.value = '';
                
        // ì‹œì—°ìš© ìë™ ì‘ë‹µ
                setTimeout(() => {
                    const responses = [
                        'ì•ˆë…•í•˜ì„¸ìš”!',
                        'ë„¤, ë§ìŠµë‹ˆë‹¤.',
                        'ì •ë§ìš”?',
                        'í¥ë¯¸ë¡­ë„¤ìš”!',
                        'ê·¸ë ‡êµ°ìš”.',
            'ì¢‹ì€ ìƒê°ì´ì—ìš”!',
            'ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?',
            'ë§ì•„ìš”!'
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          addMessage(randomResponse, false);
          
          // ë‹¤ë¥¸ ë°©ì— ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì¦ê°€ (í…ŒìŠ¤íŠ¸ìš©)
          if (Math.random() > 0.7) { // 30% í™•ë¥ ë¡œ ë‹¤ë¥¸ ë°©ì— ë©”ì‹œì§€ ë„ì°©
            const rooms = Object.keys(roomParticipants);
            const randomRoom = rooms[Math.floor(Math.random() * rooms.length)];
            if (randomRoom !== currentRoom) {
              incrementUnreadCount(randomRoom);
            }
          }
                }, Math.random() * 2000 + 1000);
            }
        }

    // ëœë¤ ë§¤ì¹­ í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function backToHome() {
      currentRoom = null;
      document.getElementById('chatHeader').textContent = 'ëœë¤ ë§¤ì¹­';
      document.getElementById('chatContent').style.display = 'block';
      document.getElementById('chatRoom').style.display = 'none';
      
      // ì°¸ì—¬ì ìˆ˜ì™€ ë²„íŠ¼ë“¤ ìˆ¨ê¸°ê¸°
      document.getElementById('participantCount').style.display = 'none';
      document.getElementById('backToHome').style.display = 'none';
      document.getElementById('chatOptions').style.display = 'none';
      document.getElementById('chatOptionsDropdown').style.display = 'none';
      
      // í™œì„± ì±„íŒ…ë°© ì„ íƒ í•´ì œ
      document.querySelectorAll('.room-list li').forEach(li => {
        li.classList.remove('active');
      });
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(text, isMe, nickname = null) {
            if (!currentRoom) return;
            
            const messages = document.getElementById('messages');
            
            // í˜„ì¬ ì‹œê°„ ìƒì„±
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            // ë©”ì‹œì§€ ë°ì´í„° ìƒì„±
            const messageData = {
                text: text,
                isMe: isMe,
                nickname: isMe ? (JSON.parse(localStorage.getItem('anonProfile') || '{}').nickname || 'ë‚˜') : (nickname || getRandomNickname()),
                timestamp: now.toISOString(),
                timeString: timeString
            };
            
            // ì±„íŒ… ë°ì´í„°ì— ì €ì¥
            if (!chatData.rooms[currentRoom]) {
                chatData.rooms[currentRoom] = [];
            }
            chatData.rooms[currentRoom].push(messageData);
            saveChatData();
            
            // ë©”ì‹œì§€ ë˜í¼ ìƒì„±
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `msg-wrapper ${isMe ? 'me' : ''}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `msg ${isMe ? 'me' : ''}`;
            
            if (isMe) {
                // ë‚´ ë©”ì‹œì§€
                messageDiv.innerHTML = `
                    <div class="msg-content">${text}</div>
                    <div class="msg-time">${timeString}</div>
                `;
            } else {
                // ìƒëŒ€ë°© ë©”ì‹œì§€ (ë‹‰ë„¤ì„ í¬í•¨)
                messageDiv.innerHTML = `
                    <div class="msg-nickname">${messageData.nickname}</div>
                    <div class="msg-content">${text}</div>
                    <div class="msg-time">${timeString}</div>
                `;
            }
            
            messageWrapper.appendChild(messageDiv);
            messages.appendChild(messageWrapper);
            messages.scrollTop = messages.scrollHeight;
        }

        // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
        function getRandomNickname() {
            // 1:1 ì±„íŒ…ë°©ì¸ ê²½ìš° ì±„íŒ…ë°© ì´ë¦„ì„ ë‹‰ë„¤ì„ìœ¼ë¡œ ì‚¬ìš©
            const roomData = chatData.roomList.find(room => room.name === currentRoom);
            if (roomData && roomData.type === 'dm') {
                return currentRoom;
            }
            
            // ê·¸ë£¹ ì±„íŒ…ë°©ì´ë‚˜ ê´€ì‹¬ë¶„ì•¼ ë°©ì¸ ê²½ìš°
            if (currentRoom && roomParticipants[currentRoom]) {
                const users = roomParticipants[currentRoom].users;
                // ì‹¤ì œ ì‚¬ìš©ì ë‹‰ë„¤ì„ ì¤‘ì—ì„œ ëœë¤ ì„ íƒ
                return users[Math.floor(Math.random() * users.length)];
            }
            
            // ê¸°ë³¸ê°’
            return 'ìµëª…' + Math.floor(Math.random() * 100);
        }

    // ì±„íŒ… ì˜µì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function toggleChatOptions() {
      const dropdown = document.getElementById('chatOptionsDropdown');
      const optionsBtn = document.getElementById('chatOptions');
      
      if (dropdown.style.display === 'none' || dropdown.style.display === '') {
        // ë“œë¡­ë‹¤ìš´ ìœ„ì¹˜ ê³„ì‚°
        const btnRect = optionsBtn.getBoundingClientRect();
        dropdown.style.top = (btnRect.bottom + 8) + 'px';
        dropdown.style.right = (window.innerWidth - btnRect.right) + 'px';
        dropdown.style.display = 'block';
      } else {
        dropdown.style.display = 'none';
      }
    }
    
    function showParticipants() {
      const participantsList = document.getElementById('participantsList');
      participantsList.innerHTML = '';
      
      if (currentRoom && roomParticipants[currentRoom]) {
        // ê·¸ë£¹ ì±„íŒ…ë°©ì¸ ê²½ìš°
        const users = roomParticipants[currentRoom].users;
        
        users.forEach((user, index) => {
          const participantItem = document.createElement('div');
          participantItem.className = 'participant-item';
          participantItem.onclick = () => showParticipantProfile(user);
          
          participantItem.innerHTML = `
            <div class="participant-avatar">ğŸ‘¤</div>
            <div class="participant-info">
              <div class="participant-name">${user}</div>
              <div class="participant-status">ì˜¨ë¼ì¸</div>
            </div>
            <div class="participant-profile">í”„ë¡œí•„ ë³´ê¸°</div>
          `;
          
          participantsList.appendChild(participantItem);
        });
      } else {
        // 1:1 ì±„íŒ…ë°©ì¸ ê²½ìš° (ìƒëŒ€ë°©ê³¼ ë‚˜)
        const currentUser = localStorage.getItem('anonProfile') ? 
          JSON.parse(localStorage.getItem('anonProfile')).nickname : 'ìµëª…ì˜ì¹œêµ¬';
        const opponentName = currentRoom; // 1:1 ì±„íŒ…ì—ì„œëŠ” ë°© ì´ë¦„ì´ ìƒëŒ€ë°© ì´ë¦„
        
        // ìƒëŒ€ë°© í”„ë¡œí•„
        const opponentItem = document.createElement('div');
        opponentItem.className = 'participant-item';
        opponentItem.onclick = () => showParticipantProfile(opponentName);
        
        opponentItem.innerHTML = `
          <div class="participant-avatar">ğŸ‘¤</div>
          <div class="participant-info">
            <div class="participant-name">${opponentName}</div>
            <div class="participant-status">ì˜¨ë¼ì¸</div>
          </div>
          <div class="participant-profile">í”„ë¡œí•„ ë³´ê¸°</div>
        `;
        participantsList.appendChild(opponentItem);
        
        // ë‚´ í”„ë¡œí•„
        const myItem = document.createElement('div');
        myItem.className = 'participant-item';
        myItem.onclick = () => showParticipantProfile(currentUser);
        
        myItem.innerHTML = `
          <div class="participant-avatar">ğŸ‘¤</div>
          <div class="participant-info">
            <div class="participant-name">${currentUser} (ë‚˜)</div>
            <div class="participant-status">ì˜¨ë¼ì¸</div>
          </div>
          <div class="participant-profile">í”„ë¡œí•„ ë³´ê¸°</div>
        `;
        participantsList.appendChild(myItem);
      }
      
      document.getElementById('participantsModal').style.display = 'flex';
      document.getElementById('chatOptionsDropdown').style.display = 'none';
    }
    
    function closeParticipantsModal() {
      document.getElementById('participantsModal').style.display = 'none';
    }
    
    function showParticipantProfile(nickname) {
      // ë‚´ í”„ë¡œí•„ì¸ì§€ í™•ì¸
      const currentUser = localStorage.getItem('anonProfile') ? 
        JSON.parse(localStorage.getItem('anonProfile')).nickname : 'ìµëª…ì˜ì¹œêµ¬';
      
      let profile;
      
      if (nickname === currentUser || nickname.includes('(ë‚˜)')) {
        // ë‚´ í”„ë¡œí•„ì¸ ê²½ìš°
        const myProfile = localStorage.getItem('anonProfile') ? 
          JSON.parse(localStorage.getItem('anonProfile')) : null;
        
        profile = myProfile ? {
          year: myProfile.year,
          gender: myProfile.gender,
          bio: myProfile.bio,
          interests: myProfile.interests
        } : {
          year: '2024',
          gender: 'ë‚¨ì',
          bio: 'ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!',
          interests: ['ìš´ë™', 'ìŒì•…']
        };
      } else {
        // ë‹¤ë¥¸ ì‚¬ìš©ì í”„ë¡œí•„ì¸ ê²½ìš°
        const mockProfiles = {
          'ìµëª…1': { year: '2024', gender: 'ë‚¨ì', bio: 'ìš´ë™ì„ ì¢‹ì•„í•˜ëŠ” í•™ìƒì…ë‹ˆë‹¤.', interests: ['ìš´ë™', 'ìŒì•…'] },
          'ìµëª…2': { year: '2023', gender: 'ì—¬ì', bio: 'ë…ì„œì™€ ì˜í™”ë¥¼ ì¦ê¹ë‹ˆë‹¤.', interests: ['ë…ì„œ', 'ì˜í™”'] },
          'ìµëª…3': { year: '2025', gender: 'ë‚¨ì', bio: 'ê²Œì„ê³¼ ìš”ë¦¬ë¥¼ ì¢‹ì•„í•´ìš”.', interests: ['ê²Œì„', 'ìš”ë¦¬'] },
          'ìµëª…4': { year: '2024', gender: 'ì—¬ì', bio: 'ìŒì•…ì„ ì‚¬ë‘í•©ë‹ˆë‹¤.', interests: ['ìŒì•…', 'ìš´ë™'] },
          'ìµëª…5': { year: '2023', gender: 'ë‚¨ì', bio: 'ì˜í™” ê°ìƒì„ ì¢‹ì•„í•´ìš”.', interests: ['ì˜í™”', 'ë…ì„œ'] },
          'ì•ˆë…•': { year: '23í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ë‚˜ë„ ì¢‹ì•„', interests: ['ìš´ë™', 'ìŒì•…'] },
          'ë¯¼ì§€': { year: '22í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ë…ì„œì™€ ì¹´í˜ ì¢‹ì•„í•´ìš”', interests: ['ë…ì„œ', 'ì˜í™”'] },
          'ì² ìˆ˜': { year: '21í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ìš´ë™ ê°™ì´ í•˜ì‹¤ ë¶„!', interests: ['ìš´ë™', 'ê²Œì„'] },
          'ì§€í˜„': { year: '24í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ì˜í™” ë•í›„ì—ìš”', interests: ['ì˜í™”', 'ìŒì•…'] },
          'ì¤€í˜¸': { year: '23í•™ë²ˆ', gender: 'ë‚¨ì', bio: 'ê²Œì„ ì¢‹ì•„í•´ìš”', interests: ['ê²Œì„', 'ìš´ë™'] },
          'ìˆ˜ì§„': { year: '22í•™ë²ˆ', gender: 'ì—¬ì', bio: 'ìš”ë¦¬ ë°°ìš°ê³  ì‹¶ì–´ìš”', interests: ['ìš”ë¦¬', 'ë…ì„œ'] }
        };
        
        // ê¸°ë³¸ í”„ë¡œí•„ ì •ë³´ ìƒì„± (ëœë¤)
        const defaultProfiles = [
          { year: '2024', gender: 'ë‚¨ì', bio: 'ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´ìš”!', interests: ['ìš´ë™', 'ìŒì•…'] },
          { year: '2023', gender: 'ì—¬ì', bio: 'ì¬ë¯¸ìˆëŠ” ëŒ€í™”ë¥¼ ì¢‹ì•„í•´ìš”.', interests: ['ë…ì„œ', 'ì˜í™”'] },
          { year: '2025', gender: 'ë‚¨ì', bio: 'ê²Œì„ê³¼ ìš”ë¦¬ë¥¼ ì¢‹ì•„í•´ìš”.', interests: ['ê²Œì„', 'ìš”ë¦¬'] },
          { year: '2024', gender: 'ì—¬ì', bio: 'ìŒì•…ì„ ì‚¬ë‘í•©ë‹ˆë‹¤.', interests: ['ìŒì•…', 'ìš´ë™'] },
          { year: '2023', gender: 'ë‚¨ì', bio: 'ì˜í™” ê°ìƒì„ ì¢‹ì•„í•´ìš”.', interests: ['ì˜í™”', 'ë…ì„œ'] }
        ];
        
        const randomProfile = defaultProfiles[Math.floor(Math.random() * defaultProfiles.length)];
        profile = mockProfiles[nickname] || randomProfile;
      }
      
      const profileContent = document.getElementById('participantProfileContent');
      profileContent.innerHTML = `
        <div class="profile-avatar-large">ğŸ‘¤</div>
        <h4 style="margin: 0 0 8px 0; color: #374151;">${nickname}</h4>
        <div class="profile-details">
          <div class="profile-detail-item">
            <span class="profile-detail-label">í•™ë²ˆ</span>
            <span class="profile-detail-value">${profile.year}</span>
          </div>
          <div class="profile-detail-item">
            <span class="profile-detail-label">ì„±ë³„</span>
            <span class="profile-detail-value">${profile.gender}</span>
          </div>
          <div class="profile-detail-item">
            <span class="profile-detail-label">ì†Œê°œ</span>
            <span class="profile-detail-value">${profile.bio}</span>
          </div>
          <div class="profile-detail-item">
            <span class="profile-detail-label">ê´€ì‹¬ì‚¬</span>
            <span class="profile-detail-value">${profile.interests.join(', ')}</span>
          </div>
        </div>
      `;
      
      document.getElementById('participantProfileModal').style.display = 'flex';
      closeParticipantsModal();
    }
    
    function closeParticipantProfileModal() {
      document.getElementById('participantProfileModal').style.display = 'none';
    }
    
    
    function leaveChatRoom() {
      if (confirm('ì •ë§ë¡œ ì±„íŒ…ë°©ì„ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        if (!currentRoom) return;
        
        // ì±„íŒ…ë°© ëª©ë¡ì—ì„œ ì œê±°
        chatData.roomList = chatData.roomList.filter(room => room.name !== currentRoom);
        
        // ì±„íŒ… ê¸°ë¡ ì‚­ì œ
        if (chatData.rooms[currentRoom]) {
            delete chatData.rooms[currentRoom];
        }
        
        // ê·¸ë£¹ ì±„íŒ…ë°©ì¸ ê²½ìš° ì°¸ì—¬ì ìˆ˜ ê°ì†Œ
        if (roomParticipants[currentRoom]) {
          roomParticipants[currentRoom].count = Math.max(0, roomParticipants[currentRoom].count - 1);
          
          // ì°¸ì—¬ì ëª©ë¡ì—ì„œ í˜„ì¬ ì‚¬ìš©ì ì œê±° (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨)
          const currentUser = localStorage.getItem('anonProfile') ? 
            JSON.parse(localStorage.getItem('anonProfile')).nickname : 'ìµëª…ì˜ì¹œêµ¬';
          const userIndex = roomParticipants[currentRoom].users.indexOf(currentUser);
          if (userIndex > -1) {
            roomParticipants[currentRoom].users.splice(userIndex, 1);
          }
        }
        
        // ë°ì´í„° ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
        saveChatData();
        updateRoomListUI();
        
        // í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        backToHome();
        alert('ì±„íŒ…ë°©ì—ì„œ ë‚˜ê°”ìŠµë‹ˆë‹¤.');
      }
      document.getElementById('chatOptionsDropdown').style.display = 'none';
    }
    
    // ë°©ë³„ ì°¸ì—¬ì ìˆ˜ ì—…ë°ì´íŠ¸
    function updateRoomParticipantCount(roomName) {
      document.querySelectorAll('.room-list li').forEach(li => {
        const roomInfo = li.querySelector('.room-info');
        if (roomInfo) {
          const roomNameSpan = roomInfo.querySelector('.room-name');
          if (roomNameSpan && roomNameSpan.textContent === roomName) {
            const countSpan = roomInfo.querySelector('.participant-count');
            const newCount = roomParticipants[roomName]?.count || 0;
            countSpan.textContent = `${newCount}ëª…`;
          }
        }
      });
    }
    
    // ë°©ë³„ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì—…ë°ì´íŠ¸
    function updateRoomUnreadCount(roomName) {
      document.querySelectorAll('.room-list li').forEach(li => {
        const roomInfo = li.querySelector('.room-info');
        if (roomInfo) {
          const roomNameSpan = roomInfo.querySelector('.room-name');
          if (roomNameSpan && roomNameSpan.textContent === roomName) {
            const roomNameWrapper = roomInfo.querySelector('.room-name-wrapper');
            const unreadCount = roomParticipants[roomName]?.unreadCount || 0;
            
            // ê¸°ì¡´ ë°°ì§€ ì œê±°
            const existingBadge = roomNameWrapper.querySelector('.unread-badge');
            if (existingBadge) {
              existingBadge.remove();
            }
            
            // ìƒˆ ë°°ì§€ ì¶”ê°€ (ì½ì§€ ì•Šì€ ë©”ì‹œì§€ê°€ ìˆì„ ë•Œë§Œ)
            if (unreadCount > 0) {
              const badge = document.createElement('span');
              badge.className = 'unread-badge';
              badge.textContent = unreadCount;
              roomNameWrapper.appendChild(badge);
            }
          }
        }
      });
    }
    
    // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì¦ê°€ (ìƒëŒ€ë°© ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ)
    function incrementUnreadCount(roomName) {
      if (roomName !== currentRoom && roomParticipants[roomName]) {
        roomParticipants[roomName].unreadCount++;
        updateRoomUnreadCount(roomName);
      }
    }
    
    // ëœë¤ ë§¤ì¹­ í”„ë¡œí•„ ìƒì„±
    function generateRandomProfiles() {
      const container = document.getElementById('profileCardsContainer');
      container.innerHTML = '';
      
      randomProfiles.forEach(profile => {
        const card = document.createElement('div');
        card.className = 'random-profile-card';
        card.innerHTML = `
          <div class="random-profile-avatar">${profile.avatar}</div>
          <div class="random-profile-name">${profile.name}</div>
          <div class="random-profile-details">${profile.year} Â· ${profile.gender}</div>
          <div class="random-profile-bio">${profile.bio}</div>
          <button class="random-profile-btn" onclick="viewProfile('${profile.name}')">í”„ë¡œí•„ ë³´ê¸°</button>
        `;
        container.appendChild(card);
      });
    }
    
    // í”„ë¡œí•„ ë³´ê¸°
    function viewProfile(profileName) {
      const profile = randomProfiles.find(p => p.name === profileName);
      if (profile) {
        const modalContent = document.getElementById('profileDetailContent');
        
        // ê´€ì‹¬ì‚¬ íƒœê·¸ ìƒì„±
        const interestsHtml = profile.interests.map(interest => 
          `<span class="profile-detail-interest-tag">${interest}</span>`
        ).join('');
        
        modalContent.innerHTML = `
          <div class="profile-detail-avatar">${profile.avatar}</div>
          <div class="profile-detail-name">${profile.name}</div>
          <div class="profile-detail-info">${profile.year} Â· ${profile.gender}</div>
          <div class="profile-detail-bio">${profile.bio}</div>
          <div class="profile-detail-interests">
            <div class="profile-detail-interests-title">ê´€ì‹¬ì‚¬</div>
            <div class="profile-detail-interests-list">
              ${interestsHtml}
            </div>
          </div>
          <div class="profile-detail-actions">
            <button class="profile-detail-btn secondary" onclick="closeProfileDetailModal()">ë‹«ê¸°</button>
          </div>
        `;
        
        document.getElementById('profileDetailModal').style.display = 'flex';
      }
    }
    
    // í”„ë¡œí•„ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeProfileDetailModal() {
      document.getElementById('profileDetailModal').style.display = 'none';
    }
    
    
    // í”„ë¡œí•„ ìºëŸ¬ì…€ ìŠ¤í¬ë¡¤
    function scrollProfiles(direction) {
      const container = document.getElementById('profileCardsContainer');
      const scrollAmount = 220; // ì¹´ë“œ ë„ˆë¹„ + ê°„ê²©
      container.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
      });
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.addEventListener('DOMContentLoaded', function() {
      // ë…„ë„ ì„¤ì •
      document.getElementById('year').textContent = new Date().getFullYear();
      
      // ì±„íŒ… ë°ì´í„° ë¡œë“œ
      loadChatData();
      updateRoomListUI();
      
      // ì±„íŒ… ì˜µì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('chatOptions').addEventListener('click', toggleChatOptions);
      
      // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('chatOptionsDropdown');
        const optionsBtn = document.getElementById('chatOptions');
        
        if (!dropdown.contains(e.target) && !optionsBtn.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });
      
      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      document.addEventListener('click', function(e) {
        const participantsModal = document.getElementById('participantsModal');
        const participantProfileModal = document.getElementById('participantProfileModal');
        const profileDetailModal = document.getElementById('profileDetailModal');
        
        if (e.target === participantsModal) {
          closeParticipantsModal();
        }
        
        if (e.target === participantProfileModal) {
          closeParticipantProfileModal();
        }
        
        if (e.target === profileDetailModal) {
          closeProfileDetailModal();
        }
      });
      
      loadAnonProfile();
      
      // ëœë¤ ë§¤ì¹­ í”„ë¡œí•„ ìƒì„±
      generateRandomProfiles();
      
      // ê¸°ë³¸ ê´€ì‹¬ë¶„ì•¼ ë°©ë“¤ì„ ì±„íŒ…ë°© ëª©ë¡ì— ì¶”ê°€
      initializeDefaultInterestRooms();
      
      // ë§¤ì¹­ ë²„íŠ¼
      document.getElementById('startRandom').addEventListener('click', startRandomMatching);
      document.getElementById('startGroup').addEventListener('click', startGroupMatching);
      document.getElementById('cancelRandom').addEventListener('click', cancelRandomMatching);
      document.getElementById('cancelGroup').addEventListener('click', cancelGroupMatching);
      
      // ë©”ì‹œì§€ ì „ì†¡
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

      // ëœë¤ ë§¤ì¹­ í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
      document.getElementById('backToHome').addEventListener('click', backToHome);

      // ëª¨ë°”ì¼ ë©”ë‰´ëŠ” navigation.jsì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤
    });
    </script>
    <script src="script.js"></script>
    <script src="navigation.js"></script>
    <script src="router.js"></script>
</body>
</html>